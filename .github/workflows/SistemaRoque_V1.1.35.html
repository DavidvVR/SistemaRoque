<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>SistemaRoque V1.1.35</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    :root {
      --bg: #f5f5f5;
      --panel-bg: #fff;
      --frame-border: #000;
      --text: #222;
      --font: "Segoe UI", Tahoma, sans-serif;
      --input-border: #00b8f4;
      --section-bg: #e8e8e8;
      --tab-bg: #ddd;
      --tab-active: #fff;
      --tab-border: #000;
      --cta: #7c3aed;
    }
    * { box-sizing: border-box; margin:0; padding:0; }
    body { background: var(--bg); font-family: var(--font); color: var(--text); }
    .hidden { display: none; }
    .frame {
      position: relative;
      margin: 50px auto; padding: 40px 20px 20px; max-width: 920px;
      background: var(--panel-bg);
      border: 4px solid var(--frame-border);
      border-radius: 12px;
    }
    /* Login */
    #loginFrame { text-align:center; }
    #loginFrame input {
      width: calc(100% - 16px); padding: 8px; margin: 6px 0;
      border: 2px solid #ccc; border-radius: 6px;
      font-size: .9rem;
    }
    #loginFrame button {
      padding: 8px 16px; margin: 8px 4px;
      border:2px solid var(--frame-border); background:#e5e5e5; cursor:pointer; font-weight:700; border-radius:8px;
    }
    /* Dashboard */
    #dashboard h2 { text-align:center; margin-bottom:16px; }
    .dashboard { display:grid; grid-template-columns:repeat(5,1fr); gap:20px; justify-items:center; }
    .module { width:100px; height:100px; background:var(--panel-bg);
      border:2px solid var(--frame-border); border-radius:8px;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      cursor:pointer; transition:transform .1s;
    }
    .module:hover { transform:translateY(-3px); }
    .module-icon { font-size:2rem; }
    .module-label { margin-top:8px; font-weight:bold; font-size:.9rem; text-align:center; }
    /* clientsModule */
    .clients-menu {
      margin: 0 auto; width: 100%; max-width:860px; background:var(--section-bg);
      border-radius:12px; padding:20px;
    }
    /* Sub-tabs */
    .sub-tabs { display:flex; border-bottom:2px solid var(--tab-border); margin-bottom:16px; }
    .sub-tab {
      padding:8px 16px; cursor:pointer;
      background: var(--tab-bg); border:2px solid var(--tab-border); border-bottom:none;
      margin-right:4px; border-radius:8px 8px 0 0;
    }
    .sub-tab.active { background: var(--tab-active); }
    .sub-content { display:none; }
    .sub-content.active { display:block; }
    .form-group { display:grid; grid-template-columns:220px 1fr; align-items:center; gap:12px; margin:8px 0; }
    h3.section-title { margin-top:16px; font-size:1.1rem; border-bottom:1px solid #000; padding-bottom:4px; }
    .button-row { display:flex; justify-content:center; gap:12px; margin-top:16px; }
    .btn { padding:8px 16px; border:2px solid var(--frame-border); background:#e5e5e5; border-radius:8px; cursor:pointer; }
    .btn.primary { background:#efe9ff; border-color:var(--cta); }
    /* Tables */
    .doc-table-wrapper { border:2px dashed var(--input-border); padding:12px; }
    table.doc-table { width:100%; border-collapse: collapse; }
    table.doc-table th, table.doc-table td { border:1px solid var(--input-border); padding:8px; text-align:center; }
    table.doc-table th { background:#eee; }
    .icon-btn { cursor:pointer; margin: 0 4px; font-size:1.1rem; }
    .status-no { color: red; font-weight:bold; }
    .status-yes { color: green; font-weight:bold; }
    input[type="file"] { display: none; }
    /* Modal */
    .modal {
      position: fixed;
      z-index: 1000;
      inset: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }
    .modal-content {
      background-color: var(--panel-bg);
      padding: 20px;
      border: 2px solid var(--frame-border);
      border-radius: 8px;
      width: max-content;
      max-width: 96vw;
      max-height: 90vh;
      overflow: auto;
      position: relative;
    }
    .close {
      position: absolute;
      right: 10px;
      top: 5px;
      font-size: 1.5rem;
      cursor: pointer;
    }
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 12px;
    }
    .form-group-full { grid-column: span 2; }
    .form-group label { display: block; margin-bottom: 4px; font-weight: bold; }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%; padding: 8px; border: 2px solid #ccc; border-radius: 6px;
    }
    .modal-buttons {
      display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;
    }
    /* --- Selector inicial de Clientes (Home) --- */
    .clients-home{ margin:0 auto 12px; width:100%; max-width:860px; background:#e9e9ec; border-radius:12px; padding:28px 24px; outline:3px solid var(--cta); }
    .home-grid{display:grid; grid-template-columns:1fr 1fr; gap:24px; align-items:center; justify-items:center;}
    .choice-card{
      width:100%; min-height:220px; background:#efefef; border:2px solid #000; border-radius:12px;
      display:flex; flex-direction:column; align-items:center; justify-content:center; gap:18px;
      cursor:pointer; transition:transform .12s ease, box-shadow .12s ease; user-select:none;
    }
    .choice-card:hover{ transform:translateY(-2px); box-shadow:0 6px 18px rgba(0,0,0,.15);}
    .choice-card svg{ width:96px; height:96px;}
    .choice-label{ font-weight:700; letter-spacing:.03em;}
    @media (max-width:780px){ .home-grid{grid-template-columns:1fr;} }
    /* --- Lista de clientes --- */
    .list-toolbar{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin-bottom:12px; }
    .list-actions{ display:flex; gap:8px; }
    .search{ display:flex; gap:8px; align-items:center; }
    .search input{ padding:8px; border:2px solid var(--input-border); border-radius:8px; min-width:220px; }
  </style>
</head>
<body>
  <!-- LOGIN -->
  <div id="loginFrame" class="frame">
    <input type="text" id="usuario" placeholder="David Vargas R.">
    <input type="password" id="password" placeholder="1234">
    <div>
      <button id="btnGuardar" class="btn">Guardar</button>
      <button id="btnEntrar" class="btn primary">Entrar</button>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" class="frame hidden">
    <h2>Men√∫ Principal</h2>
    <div class="dashboard">
      <div class="module" id="modClientes"><div class="module-icon">üìã</div><div class="module-label">Clientes</div></div>
      <div class="module" id="modPerm"><div class="module-icon">üöö</div><div class="module-label">Permisionarios</div></div>
      <div class="module" id="modAsign"><div class="module-icon">üìÖ</div><div class="module-label">Asignaci√≥n</div></div>
      <div class="module" id="modMonit"><div class="module-icon">üì°</div><div class="module-label">Monitoreo</div></div>
      <div class="module" id="modCoord"><div class="module-icon">üîß</div><div class="module-label">Coordinaci√≥n</div></div>
      <div class="module" id="modCCP"><div class="module-icon">üí∞</div><div class="module-label">Ctas Cob/PP</div></div>
      <div class="module" id="modLiq"><div class="module-icon">üìä</div><div class="module-label">Liquidaci√≥n</div></div>
      <div class="module" id="modMant"><div class="module-icon">üõ†Ô∏è</div><div class="module-label">Mantenimiento</div></div>
      <div class="module" id="modAdmin"><div class="module-icon">üóÑÔ∏è</div><div class="module-label">Administraci√≥n</div></div>
      <div class="module" id="modDocs"><div class="module-icon">üìÑ</div><div class="module-label">Documentaci√≥n</div></div>
    </div>
  </div>

  <!-- clientsModule -->
  <div id="clientsModule" class="frame hidden">
    <!-- Home -->
    <div id="clientsHome" class="clients-home">
      <div class="home-grid">
        <div id="btnNuevoCliente" class="choice-card" role="button" tabindex="0" aria-label="Nuevo cliente">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M12 12l3 3a2 2 0 1 1-3 3l-2-2-1 1a2 2 0 1 1-3-3l1-1-1-1a2 2 0 0 1 3-3l1 1 1-1a2 2 0 1 1 3 3l-2 2z"/>
            <path d="M18 8l3-3M6 8 3 5"/>
          </svg>
          <div class="choice-label">NUEVO CLIENTE</div>
        </div>
        <div id="btnVerClientes" class="choice-card" role="button" tabindex="0" aria-label="Clientes">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="3"/>
            <path d="M22 21v-2a4 4 0 0 0-3-3.87M16 3.13a3 3 0 0 1 0 5.75"/>
          </svg>
          <div class="choice-label">CLIENTES</div>
        </div>
      </div>
    </div>

    <!-- Nuevo Cliente (pesta√±as) -->
    <div id="clientsMenu" class="clients-menu hidden">
      <div class="sub-tabs">
        <div class="sub-tab active" data-content="tab-datos">Datos Generales</div>
        <div class="sub-tab" data-content="tab-docs">Documentaci√≥n</div>
        <div class="sub-tab" data-content="tab-tarifas">Tarifas</div>
        <div class="sub-tab" data-content="tab-comentario">Comentarios</div>
      </div>

      <div id="tab-datos" class="sub-content active">
        <h3 class="section-title">Datos Generales</h3>
        <div class="form-group"><label>Nombre / Raz√≥n Social</label><input id="cliNombre" type="text"></div>
        <div class="form-group"><label>Estatus</label><select id="cliEstatus"><option>Activo</option><option>Inactivo</option></select></div>
        <div class="form-group"><label>RFC</label><input id="cliRFC" type="text"></div>
        <div class="form-group"><label>Direcci√≥n</label><textarea id="cliDir" style="width:100%;height:70px;border:2px solid #ccc;border-radius:6px;"></textarea></div>
        <h3 class="section-title">Contactos</h3>
        <div class="form-group"><label>Operaciones</label><input type="text"><input type="email"><input type="tel"></div>
        <div class="form-group"><label>Administraci√≥n</label><input type="text"><input type="email"><input type="tel"></div>
        <div class="form-group"><label>Comercial</label><input type="text"><input type="email"><input type="tel"></div>
      </div>

      <div id="tab-docs" class="sub-content">
        <h3 class="section-title">Documentaci√≥n</h3>
        <div class="doc-table-wrapper">
          <table class="doc-table">
            <thead><tr><th>Comprobante</th><th>Estatus</th><th>Documento</th></tr></thead>
            <tbody>
              <tr><td><span class="icon-btn folder" data-row="1">üìÅ</span><span class="icon-btn view" data-row="1">üîç</span><input type="file" id="file1"/></td><td id="status1" class="status-no">‚ùå No</td><td>Acta Constitutiva</td></tr>
              <tr><td><span class="icon-btn folder" data-row="2">üìÅ</span><span class="icon-btn view" data-row="2">üîç</span><input type="file" id="file2"/></td><td id="status2" class="status-no">‚ùå No</td><td>Poder Rep. Legal</td></tr>
              <tr><td><span class="icon-btn folder" data-row="3">üìÅ</span><span class="icon-btn view" data-row="3">üîç</span><input type="file" id="file3"/></td><td id="status3" class="status-no">‚ùå No</td><td>Comprobante de Domicilio</td></tr>
              <tr><td><span class="icon-btn folder" data-row="4">üìÅ</span><span class="icon-btn view" data-row="4">üîç</span><input type="file" id="file4"/></td><td id="status4" class="status-no">‚ùå No</td><td>Constancia de Situaci√≥n Fiscal</td></tr>
              <tr><td><span class="icon-btn folder" data-row="5">üìÅ</span><span class="icon-btn view" data-row="5">üîç</span><input type="file" id="file5"/></td><td id="status5" class="status-no">‚ùå No</td><td>INE Rep. Legal</td></tr>
              <tr><td><span class="icon-btn folder" data-row="6">üìÅ</span><span class="icon-btn view" data-row="6">üîç</span><input type="file" id="file6"/></td><td id="status6" class="status-no">‚ùå No</td><td>Contrato</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div id="tab-tarifas" class="sub-content">
        <h3 class="section-title">Tarifas</h3>
        <button class="btn add-route">+ Agregar Ruta/Tarifa</button>
        <div class="doc-table-wrapper" style="max-height:250px; overflow-y:auto;">
          <table class="doc-table" id="tablaTarifas">
            <thead>
              <tr>
                <th>Origen - Destino</th>
                <th>Tipo de Unidad</th>
                <th>Tarifa</th>
                <th>D√≠as de Cr√©dito</th>
                <th>Km a recorrer</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Modal -->
        <div id="tarifaModal" class="modal hidden">
          <div class="modal-content">
            <span class="close" title="Cerrar">&times;</span>
            <h3>Agregar Nueva Ruta/Tarifa</h3>

            <div class="form-row">
              <div class="form-group">
                <label for="estadoOrigen">Estado de Origen*</label>
                <select id="estadoOrigen" required>
                  <option value="">Seleccione un estado...</option>
                  <option>Aguascalientes</option><option>Baja California</option><option>Baja California Sur</option>
                  <option>Campeche</option><option>Coahuila</option><option>Colima</option><option>Chiapas</option>
                  <option>Chihuahua</option><option>Ciudad de M√©xico</option><option>Durango</option><option>Guanajuato</option>
                  <option>Guerrero</option><option>Hidalgo</option><option>Jalisco</option><option>Estado de M√©xico</option>
                  <option>Michoac√°n</option><option>Morelos</option><option>Nayarit</option><option>Nuevo Le√≥n</option>
                  <option>Oaxaca</option><option>Puebla</option><option>Quer√©taro</option><option>Quintana Roo</option>
                  <option>San Luis Potos√≠</option><option>Sinaloa</option><option>Sonora</option><option>Tabasco</option>
                  <option>Tamaulipas</option><option>Tlaxcala</option><option>Veracruz</option><option>Yucat√°n</option><option>Zacatecas</option>
                </select>
              </div>
              <div class="form-group">
                <label for="municipioOrigen">Municipio de Origen</label>
                <input type="text" id="municipioOrigen" placeholder="Opcional">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="estadoDestino">Estado de Destino*</label>
                <select id="estadoDestino" required>
                  <option value="">Seleccione un estado...</option>
                  <option>Aguascalientes</option><option>Baja California</option><option>Baja California Sur</option>
                  <option>Campeche</option><option>Coahuila</option><option>Colima</option><option>Chiapas</option>
                  <option>Chihuahua</option><option>Ciudad de M√©xico</option><option>Durango</option><option>Guanajuato</option>
                  <option>Guerrero</option><option>Hidalgo</option><option>Jalisco</option><option>Estado de M√©xico</option>
                  <option>Michoac√°n</option><option>Morelos</option><option>Nayarit</option><option>Nuevo Le√≥n</option>
                  <option>Oaxaca</option><option>Puebla</option><option>Quer√©taro</option><option>Quintana Roo</option>
                  <option>San Luis Potos√≠</option><option>Sinaloa</option><option>Sonora</option><option>Tabasco</option>
                  <option>Tamaulipas</option><option>Tlaxcala</option><option>Veracruz</option><option>Yucat√°n</option><option>Zacatecas</option>
                </select>
              </div>
              <div class="form-group">
                <label for="municipioDestino">Municipio de Destino</label>
                <input type="text" id="municipioDestino" placeholder="Opcional">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group form-group-full">
                <label for="tipoUnidad">Tipo de unidad*</label>
                <select id="tipoUnidad" required>
                  <option value="">Seleccione...</option>
                  <option>Unidad seca de 53"</option>
                  <option>Refrigerada de 53"</option>
                  <option>Thorton</option>
                  <option>3.5</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="diasCredito">D√≠as de Cr√©dito</label>
                <input type="number" id="diasCredito" min="0" placeholder="0">
              </div>
              <div class="form-group">
                <label for="kmRecorrer">Km a recorrer</label>
                <input type="number" id="kmRecorrer" min="0" placeholder="0">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="tarifa">Tarifa*</label>
                <input type="number" id="tarifa" min="0" step="0.01" required placeholder="0.00">
              </div>
            </div>

            <div class="modal-buttons">
              <button type="button" class="btn btn-cancelar">Cancelar</button>
              <button type="button" class="btn primary btn-guardar">Guardar</button>
            </div>
          </div>
        </div>
        <!-- /Modal -->
      </div>

      <div id="tab-comentario" class="sub-content">
        <h3 class="section-title">Comentarios</h3>
        <div class="form-group"><label>Comentario</label><textarea style="width:100%;height:120px;border:2px solid #ccc;border-radius:6px;"></textarea></div>
      </div>

      <div class="button-row">
        <button id="saveClient" class="btn primary">Guardar</button>
        <button id="exitClient" class="btn">Salir</button>
      </div>
    </div>

    <!-- NUEVA VENTANA: Lista de Clientes -->
    <div id="clientsList" class="clients-menu hidden" aria-label="Lista de clientes">
      <div class="list-toolbar">
        <div><h3>Clientes registrados</h3></div>
        <div class="search">
          <label for="searchCli">Buscar:</label>
          <input id="searchCli" type="text" placeholder="Nombre, RFC‚Ä¶">
        </div>
        <div class="list-actions">
          <button id="btnNuevoDesdeLista" class="btn primary">+ Nuevo Cliente</button>
          <button id="btnVolverHome" class="btn">Volver</button>
        </div>
      </div>
      <div class="doc-table-wrapper" style="max-height:300px; overflow:auto;">
        <table class="doc-table" id="tablaClientes">
          <thead>
            <tr>
              <th>Nombre/Raz√≥n Social</th>
              <th>RFC</th>
              <th>Estatus</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody><!-- filas din√°micas --></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    const usuarios = [{usuario:"David Vargas R.",password:"1234"}];

    // Peque√±a "BD" local
    const srStoreKey = 'sr_clientes';
    function getClientes(){ try { return JSON.parse(localStorage.getItem(srStoreKey)) || []; } catch { return []; } }
    function setClientes(arr){ localStorage.setItem(srStoreKey, JSON.stringify(arr)); }

    function showSection(id) {
      document.querySelectorAll('.frame').forEach(f => f.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
    }
    function showInClientsModule(el){
      const home  = document.getElementById('clientsHome');
      const menu  = document.getElementById('clientsMenu');
      const list  = document.getElementById('clientsList');
      [home,menu,list].forEach(x => x && x.classList.add('hidden'));
      el && el.classList.remove('hidden');
    }

    function renderTablaClientes(filtro=''){
      const tbody = document.querySelector('#tablaClientes tbody');
      if(!tbody) return;
      const data = getClientes();
      const q = (filtro||'').toLowerCase();
      const fil = data.filter(c =>
        (!q) || (c.nombre?.toLowerCase().includes(q) || c.rfc?.toLowerCase().includes(q))
      );
      tbody.innerHTML = fil.map(c => \`
        <tr>
          <td>\${c.nombre || ''}</td>
          <td>\${c.rfc || ''}</td>
          <td>\${c.estatus || 'Activo'}</td>
          <td><button class="btn btnVer">Ver</button></td>
        </tr>
      \`).join('') || \`<tr><td colspan="4">Sin registros</td></tr>\`;
    }

    window.addEventListener('DOMContentLoaded', () => {
      /* Login */
      const last = localStorage.getItem('sr_last_user');
      if (last) document.getElementById('usuario').value = last;
      document.getElementById('btnGuardar').onclick = () => {
        localStorage.setItem('sr_last_user', document.getElementById('usuario').value);
        alert('Usuario guardado');
      };
      document.getElementById('btnEntrar').onclick = () => {
        const u = document.getElementById('usuario').value;
        const p = document.getElementById('password').value;
        if (usuarios.find(x => x.usuario === u && x.password === p)) showSection('dashboard');
        else alert('Usuario o contrase√±a incorrectos');
      };

      /* Navegaci√≥n principal */
      document.getElementById('modClientes').onclick = () => {
        showSection('clientsModule');
        showInClientsModule(document.getElementById('clientsHome'));
      };

      /* Home -> Nuevo cliente */
      document.getElementById('btnNuevoCliente')?.addEventListener('click', () => {
        showInClientsModule(document.getElementById('clientsMenu'));
        document.querySelector('.sub-tab[data-content="tab-datos"]')?.click();
      });

      /* Home -> Ver clientes (NUEVA VENTANA) */
      document.getElementById('btnVerClientes')?.addEventListener('click', () => {
        showInClientsModule(document.getElementById('clientsList'));
        renderTablaClientes();
      });

      /* Lista -> Volver y Nuevo */
      document.getElementById('btnVolverHome')?.addEventListener('click', () => {
        showInClientsModule(document.getElementById('clientsHome'));
      });
      document.getElementById('btnNuevoDesdeLista')?.addEventListener('click', () => {
        showInClientsModule(document.getElementById('clientsMenu'));
        document.querySelector('.sub-tab[data-content="tab-datos"]')?.click();
      });

      /* B√∫squeda en la lista */
      document.getElementById('searchCli')?.addEventListener('input', (e) => {
        renderTablaClientes(e.target.value);
      });

      /* Tabs internos */
      document.querySelectorAll('.sub-tab').forEach(tab => {
        tab.onclick = () => {
          document.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.sub-content').forEach(c => c.classList.remove('active'));
          tab.classList.add('active');
          document.getElementById(tab.dataset.content).classList.add('active');
        };
      });

      document.getElementById('exitClient').onclick = () => showSection('dashboard');

      /* Guardar cliente */
      document.getElementById('saveClient')?.addEventListener('click', () => {
        const nombre  = document.getElementById('cliNombre')?.value?.trim();
        const rfc     = document.getElementById('cliRFC')?.value?.trim();
        const estatus = document.getElementById('cliEstatus')?.value || 'Activo';
        if(!nombre){
          alert('Captura al menos el Nombre/Raz√≥n Social.');
          return;
        }
        const data = getClientes();
        data.push({ nombre, rfc, estatus, creado: new Date().toISOString() });
        setClientes(data);
        alert('Cliente guardado.');
      });

      /* Documentaci√≥n (manejadores de iconos) */
      document.querySelectorAll('.folder').forEach(btn => {
        btn.onclick = () => {
          const row = btn.dataset.row;
          const inp = document.getElementById('file' + row);
          inp.click();
          inp.onchange = () => {
            const st = document.getElementById('status' + row);
            st.textContent = '‚úÖ S√≠';
            st.classList.remove('status-no');
            st.classList.add('status-yes');
          };
        };
      });
      document.querySelectorAll('.view').forEach(btn => {
        btn.onclick = () => {
          const row = btn.dataset.row;
          const inp = document.getElementById('file' + row);
          if (inp.files.length) {
            const url = URL.createObjectURL(inp.files[0]);
            window.open(url);
          } else alert('No hay archivo cargado a√∫n');
        };
      });

      /* --- Tarifas / Modal --- */
      const modal = document.getElementById('tarifaModal');
      const tablaTarifas = document.querySelector('#tablaTarifas tbody');
      let editingRow = null;
      const tituloModal = modal.querySelector('h3');

      function mostrarModal() {
        modal.classList.remove('hidden');
        modal.style.display = 'flex';
      }
      function ocultarModal() {
        modal.classList.add('hidden');
        modal.style.display = 'none';
      }
      function activarTabTarifas() {
        document.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.sub-content').forEach(c => c.classList.remove('active'));
        document.querySelector('.sub-tab[data-content="tab-tarifas"]').classList.add('active');
        document.getElementById('tab-tarifas').classList.add('active');
      }
      function limpiarFormularioTarifa() {
        document.getElementById('estadoOrigen').value = '';
        document.getElementById('municipioOrigen').value = '';
        document.getElementById('estadoDestino').value = '';
        document.getElementById('municipioDestino').value = '';
        document.getElementById('tipoUnidad').selectedIndex = 0;
        document.getElementById('diasCredito').value = '';
        document.getElementById('kmRecorrer').value = '';
        document.getElementById('tarifa').value = '';
      }
      function cargarFormularioTarifa(datos) {
        document.getElementById('estadoOrigen').value   = datos.estadoOrigen || '';
        document.getElementById('municipioOrigen').value= datos.municipioOrigen || '';
        document.getElementById('estadoDestino').value  = datos.estadoDestino || '';
        document.getElementById('municipioDestino').value= datos.municipioDestino || '';
        document.getElementById('tipoUnidad').value     = datos.tipoUnidad || '';
        document.getElementById('diasCredito').value    = datos.diasCredito ?? '';
        document.getElementById('kmRecorrer').value     = datos.kmRecorrer ?? '';
        document.getElementById('tarifa').value         = datos.tarifa ?? '';
      }
      function guardarTarifa() {
        const datos = {
          estadoOrigen: document.getElementById('estadoOrigen').value.trim(),
          municipioOrigen: document.getElementById('municipioOrigen').value.trim(),
          estadoDestino: document.getElementById('estadoDestino').value.trim(),
          municipioDestino: document.getElementById('municipioDestino').value.trim(),
          tipoUnidad: document.getElementById('tipoUnidad').value,
          diasCredito: document.getElementById('diasCredito').value,
          kmRecorrer: document.getElementById('kmRecorrer').value,
          tarifa: document.getElementById('tarifa').value
        };

        if (!datos.estadoOrigen || !datos.estadoDestino || !datos.tipoUnidad || !datos.tarifa) {
          alert('Por favor complete todos los campos obligatorios (*)');
          return;
        }

        const cOrigenDestino = \`\${datos.estadoOrigen} - \${datos.estadoDestino}\`;
        const cTipo = datos.tipoUnidad;
        const cTarifa = Number(datos.tarifa).toLocaleString('es-MX', {style:'currency', currency:'MXN'});
        const cCred  = datos.diasCredito || 0;
        const cKm    = datos.kmRecorrer || 0;

        if (editingRow) {
          editingRow.cells[0].textContent = cOrigenDestino;
          editingRow.cells[1].textContent = cTipo;
          editingRow.cells[2].textContent = cTarifa;
          editingRow.cells[3].textContent = cCred;
          editingRow.cells[4].textContent = cKm;
          editingRow.dataset.info = JSON.stringify(datos);
        } else {
          const tr = document.createElement('tr');
          tr.dataset.info = JSON.stringify(datos);
          tr.innerHTML = \`
            <td>\${cOrigenDestino}</td>
            <td>\${cTipo}</td>
            <td>\${cTarifa}</td>
            <td>\${cCred}</td>
            <td>\${cKm}</td>
            <td><span class="icon-btn edit-tarifa" title="Editar">‚úèÔ∏è</span></td>
          \`;
          tablaTarifas.appendChild(tr);
        }

        ocultarModal();
        limpiarFormularioTarifa();
        activarTabTarifas();
        editingRow = null;
        tituloModal.textContent = 'Agregar Nueva Ruta/Tarifa';
      }

      const agregarBtn = document.querySelector('.add-route');
      if (agregarBtn) agregarBtn.addEventListener('click', () => {
        editingRow = null;
        tituloModal.textContent = 'Agregar Nueva Ruta/Tarifa';
        limpiarFormularioTarifa();
        mostrarModal();
      });

      document.querySelector('#tarifaModal .close').addEventListener('click', () => { ocultarModal(); activarTabTarifas(); });
      document.querySelector('#tarifaModal .btn-cancelar').addEventListener('click', () => { ocultarModal(); activarTabTarifas(); });
      document.querySelector('#tarifaModal .btn-guardar').addEventListener('click', guardarTarifa);

      window.addEventListener('click', (e) => { if (e.target === modal) ocultarModal(); });

      tablaTarifas.addEventListener('click', (e) => {
        const btn = e.target.closest('.edit-tarifa');
        if (!btn) return;
        const row = btn.closest('tr');
        try {
          const datos = JSON.parse(row.dataset.info || '{}');
          cargarFormularioTarifa(datos);
          editingRow = row;
          tituloModal.textContent = 'Editar Ruta/Tarifa';
          mostrarModal();
        } catch {
          alert('No fue posible cargar los datos de la fila para edici√≥n.');
        }
      });
    });
  </script>
</body>
</html>
