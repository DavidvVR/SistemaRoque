      <!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>SistemaRoque V1.2.48.2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    :root {
      --bg: #f5f5f5;
      --panel-bg: #fff;
      --frame-border: #000;
      --text: #222;
      --font: "Segoe UI", Tahoma, sans-serif;
      --input-border: #808000;
      --section-bg: #c9a909e6;
      --tab-bg: #ddd;
      --tab-active: #fff;
      --tab-border: #000;
    }
    * { box-sizing: border-box; margin:0; padding:0; }
    body { background: var(--bg); font-family: var(--font); color: var(--text); }
    .hidden { display: none; }
    .frame {
      position: relative;
      margin: 50px auto; padding: 40px 20px 20px; max-width: 920px;
      background: var(--panel-bg);
      border: 4px solid var(--frame-border);
      border-radius: 12px;
    }
    /* Login */
    #loginFrame { text-align:center; }
    #loginFrame input {
      width: calc(100% - 16px); padding: 8px; margin: 6px 0;
      border: 2px solid #ccc; border-radius: 6px;
      font-size: .9rem;
    }
    #loginFrame button {
      padding: 8px 16px; margin: 8px 4px;
      border:2px solid var(--frame-border); background:#e5e5e5; cursor:pointer; font-weight:700; border-radius:8px;
    }
    /* Dashboard */
    #dashboard h2 { text-align:center; margin-bottom:16px; }
    .dashboard { display:grid; grid-template-columns:repeat(5,1fr); gap:20px; justify-items:center; }
    .module { width:100px; height:100px; background:var(--panel-bg);
      border:2px solid var(--frame-border); border-radius:8px;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      cursor:pointer; transition:transform .1s;
    }
    .module:hover { transform:translateY(-3px); }
    .module-icon { font-size:2rem; }
    .module-label { margin-top:8px; font-weight:bold; font-size:.9rem; text-align:center; }
    /* clientsModule */
    .clients-menu {
      margin: 0 auto; width: 100%; max-width:860px; background:var(--section-bg);
      border-radius:12px; padding:20px;
    }
    /* Sub-tabs */
    .sub-tabs { display:flex; border-bottom:2px solid var(--tab-border); margin-bottom:16px; }
    .sub-tab {
      padding:8px 16px; cursor:pointer;
      background: var(--tab-bg); border:2px solid var(--tab-border); border-bottom:none;
      margin-right:4px; border-radius:8px 8px 0 0;
    }

    .btn {
  padding: 8px 16px;
  margin: 8px 4px;
  border: 2px solid #000;    /* Puedes usar var(--frame-border) si tienes variables CSS */
  background: #e5e5e5;
  cursor: pointer;
  font-weight: 700;
  border-radius: 8px;
    }
  
    .sub-tab.active { background: var(--tab-active); }
    .sub-content { display:none; }
    .sub-content.active { display:block; }
    .form-group { display:grid; grid-template-columns:220px 1fr; align-items:center; gap:12px; margin:8px 0; }
    h3.section-title { margin-top:16px; font-size:1.1rem; border-bottom:1px solid #000; padding-bottom:4px; }
    .button-row { display:flex; justify-content:center; gap:12px; margin-top:16px; }
    /* Documentation table */
    .doc-table-wrapper { border:2px dashed var(--input-border); padding:12px; }
    table.doc-table { width:100%; border-collapse: collapse; }
    table.doc-table th, table.doc-table td { border:1px solid var(--input-border); padding:8px; text-align:center; }
    table.doc-table th { background:#eee; }
    .icon-btn { cursor:pointer; margin: 0 4px; font-size:1.2rem; }
    .btnDelete { color: #d00; }
    .status-no { color: red; font-weight:bold; }
    .status-yes { color: green; font-weight:bold; }
    input[type="file"] { display: none; }
    /* Modal */
    .modal {
      position: fixed;
      z-index: 1000;
      inset: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }
    .modal-content {
      background-color: var(--panel-bg);
      padding: 20px;
      border: 2px solid var(--frame-border);
      border-radius: 8px;
      width: max-content;
      max-width: 96vw;
      max-height: 90vh;
      overflow: auto;
      position: relative;
    }
    .close {
      position: absolute;
      right: 10px;
      top: 5px;
      font-size: 1.5rem;
      cursor: pointer;
    }
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 12px;
    }
    .form-group-full {
      grid-column: span 2;
    }
    .form-group label {
      display: block;
      margin-bottom: 4px;
      font-weight: bold;
    }
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 8px;
      border: 2px solid #ccc;
      border-radius: 6px;
    }
    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }
     /* --- Selector inicial de Clientes --- */
.clients-home{
  margin:0 auto 12px; width:100%; max-width:860px;
  background:#e9e9ec; border-radius:12px; padding:28px 24px;
  outline:3px solid #7c3aed; /* morado */
}
.home-grid{display:grid; grid-template-columns:1fr 1fr; gap:24px; align-items:center; justify-items:center;}
.choice-card{
  width:100%; min-height:220px; background:#efefef; border:2px solid #000; border-radius:12px;
  display:flex; flex-direction:column; align-items:center; justify-content:center; gap:18px;
  cursor:pointer; transition:transform .12s ease, box-shadow .12s ease; user-select:none;
}
.choice-card:hover{ transform:translateY(-2px); box-shadow:0 6px 18px rgba(0,0,0,.15);}
.choice-card svg{ width:96px; height:96px;}
.choice-label{ font-weight:700; letter-spacing:.03em;}
@media (max-width:780px){ .home-grid{grid-template-columns:1fr;} }
    
#clientsModule{
  display:flex;
  flex-direction:column;
}
    #clientsModule.hidden {
  display:none;
}
.h
.home-actions{
  
  margin-top:auto;
  display:flex;
  justify-content:flex-end;
}
  /* --- Lista de clientes (nueva ventana) --- */
.clients-list .list-toolbar{
  display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin-bottom:12px;
}
.clients-list .list-actions{ display:flex; gap:8px; }
.clients-list .search{ display:flex; gap:8px; align-items:center; }
.clients-list .search input{
  padding:8px; border:2px solid var(--input-border); border-radius:8px; min-width:220px;
}
.btn { padding:8px 16px; border:2px solid var(--frame-border); background:#e5e5e5; border-radius:8px; cursor:pointer; }
btn.primary { background:#efe9ff; border-color:#7c3aed; }

.client-id-link { color:#000; text-decoration:underline; cursor:pointer; }


 /* --- te ayuda a que no se baje nada de esa celda --- */
    .doc-table td.actions { white-space: nowrap; }

    .confirm-cliente {
  background-color: #666; /* gris oscuro */
  color: #fff;
  text-align: center;
}

.confirm-cliente h3 {
  margin-bottom: 8px;
}

.confirm-cliente .id-cliente {
  color: red;
  font-weight: bold;
  margin-bottom: 12px;
  font-size: 1.1rem;
}

.confirm-cliente .datos-cliente {
  text-align: left;
  background-color: rgba(255,255,255,0.1);
  padding: 10px;
  border-radius: 6px;
}

.confirm-cliente .datos-cliente p {
  margin: 4px 0;
}
    
  display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin-bottom:12px;
}
.perms-list .list-actions{ display:flex; gap:8px; }
.perms-list .search{ display:flex; gap:8px; align-items:center; }
.perms-list .search input{
  padding:8px; border:2px solid var(--input-border); border-radius:8px; min-width:220px;
}
  /* --- Bot√≥n + Nuevo Permisionario --- */
.btn.primary { background:#efe9ff; border-color:#7c3aed; }

/* --- Formulario: Nuevo Permisionario --- */
#permsMenu { background: var(--section-bg); }

/* --- Sub-tabs Permisionarios --- */
.subtabs { display:flex; gap:8px; margin: 12px 0; border-bottom: 2px solid var(--input-border); }
.subtabs .subtab {
  padding: 8px 12px; cursor:pointer; border-radius: 8px 8px 0 0;
}
.subtabs .subtab.active {
  background: var(--chip-bg, #f0f3f7);
  font-weight: 600;
}
.subcontent { display:none; }
.subcontent.active { display:block; }

.form-row { display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:12px; }
.form-row .fld { display:flex; flex-direction:column; gap:6px; }
.form-row input, .form-row select, .form-row textarea {
  padding: 8px; border: 2px solid var(--input-border); border-radius: 8px;
}
.actions-bar { display:flex; gap:8px; justify-content:flex-end; margin-top: 12px; 
}
    
    
  /* V1.2.48.2 UX refinements */
.icon-btn{ cursor:pointer; display:inline-flex; align-items:center; justify-content:center; line-height:1; }
.field-error{ color:#c62828; font-size:.85rem; margin-top:4px; }
.form-group.error input,
.form-group.error select{ border:1px solid #c62828 !important; outline-color:#c62828; }
.file-row input[type="text"]{ flex:1; }
</style>

<!-- THEME 1.2.70 OVERRIDES: visual only -->
<style id="theme-1270-overrides">
  :root{
    /* keep 1.2.68 palette and add panel color */
    --accent:#1f7a4f;
    --accent-2:#22a06b;
    --accent-soft:#e9f7f1;
    --panel:#f3fbf7; /* NEW: soft green panel for first-level cards/frames */
    --danger:#c0392b;
    --text:#1e1e1e;
    --muted:#6b7280;
    --bg:#f7f9f8;
    --white:#ffffff;
    --shadow:0 14px 30px rgba(0,0,0,.10);
    --radius:18px;
  }

  /* App background */
  body{ background:var(--bg); color:var(--text); }

  /* FIRST-LEVEL CONTAINERS: switch from white to soft green panel */
  .frame,
  .clients-menu,
  .clients-home,
  .clients-list,
  #permModule .clients-menu,
  #permsMenu.frame,
  .content, .wrapper, .panel, .card.frame {
    background:var(--panel) !important;
    border:none !important;
    border-radius:var(--radius) !important;
    box-shadow:var(--shadow) !important;
  }

  /* Inner cards (keep white to preserve contrast inside panels) */
  .inner-card, .section, .tab-content, .box, .card, .table-wrapper, .doc-table-wrapper {
    background:var(--white) !important;
    border-radius:16px !important;
    box-shadow:0 6px 16px rgba(0,0,0,.05);
  }

  /* Tables */
  .doc-table, table.doc-table{ width:100%; border-collapse:collapse; overflow:hidden; }
  .doc-table th, table.doc-table th{
    text-align:left; font-size:.9rem; color:#334155;
    background:#eef5f1; /* slightly greenish header */
    padding:12px 10px; border-bottom:1px solid #e2e8f0;
  }
  .doc-table td, table.doc-table td{ padding:12px 10px; border-bottom:1px solid #eef2f7; }
  .doc-table tr:hover{ background:#f8fbf9; }

  /* Buttons */
  .btn, button, .button-row button, .list-actions .btn {
    border:none !important;
    border-radius:999px !important;
    padding:12px 18px !important;
    background:var(--accent) !important;
    color:#fff !important;
    font-weight:700 !important;
    cursor:pointer;
    transition:.2s transform ease,.2s opacity ease,.2s box-shadow ease;
    box-shadow:0 6px 14px rgba(31,122,79,.22);
  }
  .btn:hover, button:hover{ opacity:.95; transform:translateY(-1px); box-shadow:0 10px 22px rgba(31,122,79,.28); }
  .btn.primary{ background:var(--accent-2) !important; }
  .btn.ghost{ background:transparent !important; color:var(--accent) !important; border:2px solid var(--accent) !important; box-shadow:none !important; }
  .btn.danger{ background:var(--danger) !important; }

  /* Inputs */
  input, select, textarea{
    border:1.5px solid #d9dde3 !important;
    border-radius:12px !important;
    padding:10px 12px !important;
    background:#fff;
    transition:border-color .15s ease, box-shadow .15s ease;
  }
  input:focus, select:focus, textarea:focus{
    border-color:var(--accent) !important;
    box-shadow:0 0 0 3px rgba(34,160,107,.14);
  }

  /* Sub-tabs */
  .sub-tabs, .subtabs{ border-bottom:1px solid #e5e7eb !important; gap:8px; }
  .sub-tab, .subtabs .subtab{
    background:#f2f6f4 !important;
    border:none !important;
    color:#0f172a;
    border-radius:12px 12px 0 0 !important;
    padding:12px 16px !important;
  }
  .sub-tab.active, .subtabs .subtab.active{ background:#fff !important; box-shadow:inset 0 -3px 0 var(--accent); font-weight:800; }

  /* MODALS: WIDER WINDOWS */
  .modal{ background:rgba(0,0,0,.38) !important; padding:20px !important; }
  .modal .modal-content{
    background:#fff !important;
    border:none !important;
    border-radius:22px !important;
    box-shadow:0 20px 48px rgba(0,0,0,.18) !important;
    width:min(880px, 96vw) !important;   /* wider */
    max-height:90vh !important;
    padding:32px !important;
    position:relative;
  }
  /* In case some modals use different class names */
  .modal .content, .modal .card{ width:min(880px,96vw) !important; }

  .modal .close{ position:absolute; right:12px; top:10px; font-size:28px; cursor:pointer; color:#0f172a; }

  /* Confirmation modal top border accent */
  .confirm-cliente, .modal-content.confirm-cliente{ border-top:6px solid var(--accent) !important; }
  .id-cliente{
    background:var(--accent-soft); color:var(--accent);
    border:1px dashed var(--accent);
    border-radius:12px; padding:10px 12px; font-weight:800; letter-spacing:.4px;
    display:inline-block;
  }

  /* Utilities */
  @media (max-width:760px){
    .form-row{ grid-template-columns:1fr !important; }
    .modal .modal-content{ width:96vw !important; }
  }
</style>


<!-- THEME-->
<style id="theme-1271-overrides">
  .modal .modal-content{
    width:min(960px, 96vw) !important;  /* expanded width */
    padding:36px !important;
  }
  .modal .content, .modal .card{ width:min(960px,96vw) !important; }
  @media (max-width:760px){
    .modal .modal-content{ width:96vw !important; padding:24px !important; }
  }
</style>
<style>
.modal-card {
  background: #fff;
  border-radius: 18px;
  box-shadow: 0 14px 30px rgba(0,0,0,.13);
  padding: 32px 30px;
  max-width: 650px;
  width: 96vw;
  color: #1e1e1e;
  position: relative;
}
.modal-card h2 {
  font-size: 1.38rem;
  margin-bottom: 18px;
  color: #1f7a4f;
  font-weight: 700;
  text-align: left;
}
.modal-section {
  margin-bottom: 26px;
}
.modal-section h3 {
  font-size: 1.05rem;
  color: #22a06b;
  margin-bottom: 8px;
  font-weight: 600;
  border-bottom: 1px solid #e9f7f1;
  padding-bottom: 3px;
}
.modal-fields p {
  margin: 3px 0 8px 0;
  font-size: 1rem;
  display: flex;
  gap: 12px;
}
.modal-fields label {
  font-weight: 600;
  color: #334155;
  min-width: 120px;
  display: inline-block;
}
.doc-list {
  list-style: none;
  padding: 0;
  margin: 0;
}
.doc-list li {
  margin-bottom: 6px;
  display: flex;
  align-items: center;
  gap: 7px;
  font-size: .97rem;
}
.doc-list .status-yes {
  color: #1f7a4f;
  font-weight:700;
}
.doc-list .status-no {
  color: #c0392b;
  font-weight:700;
}
.modal-table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 6px;
  font-size: .97rem;
}
.modal-table th, .modal-table td {
  padding: 8px 7px;
  border-bottom: 1px solid #e2e8f0;
  text-align: left;
}
.modal-table th {
  background: #e9f7f1;
  color: #1f7a4f;
  font-weight: 600;
}
.modal-comments {
  background: #f3fbf7;
  border-radius: 10px;
  padding: 14px;
  font-size: 1rem;
  color: #334155;
  margin: 0;
}
@media (max-width: 600px) {
  .modal-card {padding:16px 6vw;}
}
.perm-id-link {
  background: none;
  border: none;
  color: #c0392b;
  text-decoration: underline;
  cursor: pointer;
  padding: 0;
  font: inherit;
}
</style>
</head>
<body>

  <!-- Modales (movidos dentro de <body>) -->
<!-- Modal de confirmaci√≥n de cliente -->
<div id="clienteModal" class="modal hidden">
  <div class="modal-content" style="text-align:center; padding: 40px;">
    <span class="close" title="Cerrar">&times;</span>
    <h2>¬°Felicidades, agregaste un nuevo cliente!</h2>
    <div class="id-cliente">ID CLIENTE: <span id="idClienteTexto">LTR-CL-01</span></div>
    <div class="datos-cliente">
      <p><strong>Cliente:</strong> <span id="nombreCliente"></span></p>
      <p><strong>RFC:</strong> <span id="rfcCliente"></span></p>
      <p><strong>Domicilio:</strong> <span id="domicilioCliente"></span></p>
    </div>
    <div class="modal-buttons">
      <button type="button" class="btn-cerrar">Cerrar</button>
  </div>
  </div>
  <!-- Modal de confirmaci√≥n de eliminaci√≥n -->
</div>

<div id="confirmDeleteModal" class="modal hidden">
  <div class="modal-content" style="text-align:center; padding: 40px;">
    <span class="close" title="Cerrar">&times;</span>
    <p>¬øDesea eliminar este cliente?</p>
    <div class="modal-buttons" style="justify-content:center;">
      <button id="deleteConfirmYes" class="btn primary">S√≠</button>
      <button id="deleteConfirmNo" class="btn">No</button>
    </div>
  </div>
</div>
<!-- Modal para ver detalles del cliente -->
<div id="detalleClienteModal" class="modal hidden">
  <div class="modal-content">
    <span class="close" title="Cerrar">&times;</span>
    <div id="detalleClienteContenido"></div>
  </div>
</div>

    
    

    <!-- Aqui acaba el .css y empieza el html la segunda parte para que sea mas facil ubicarlo -->


    
    
  <!-- LOGIN -->
  <div id="loginFrame" class="frame">
    <input type="text" id="usuario" placeholder="David Vargas R.">
    <input type="password" id="password" placeholder="1234">
    <div>
      <button id="btnGuardar">Guardar</button>
      <button id="btnEntrar">Entrar</button>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" class="frame hidden">
    <h2>Men√∫ Principal</h2>
    <div class="dashboard">
      <div class="module" id="modClientes"><div class="module-icon">üìã</div><div class="module-label">Clientes</div></div>
      <div class="module" id="modPerm"><div class="module-icon">üöö</div><div class="module-label">Permisionarios</div></div>
       <div class="module" id="modPerm"><div class="module-icon">üöö</div><div class="module-label">LTR</div></div>    
      <div class="module" id="modAsign"><div class="module-icon">üìÖ</div><div class="module-label">Asignaci√≥n</div></div>
      <div class="module" id="modMonit"><div class="module-icon">üì°</div><div class="module-label">Monitoreo</div></div>
      <div class="module" id="modCoord"><div class="module-icon">üîß</div><div class="module-label">Coordinaci√≥n</div></div>
      <div class="module" id="modCCP"><div class="module-icon">üí∞</div><div class="module-label">Ctas Cob/PP</div></div>
      <div class="module" id="modLiq"><div class="module-icon">üìä</div><div class="module-label">Liquidaci√≥n</div></div>
      <div class="module" id="modMant"><div class="module-icon">üõ†Ô∏è</div><div class="module-label">Mantenimiento</div></div>
      <div class="module" id="modAdmin"><div class="module-icon">üóÑÔ∏è</div><div class="module-label">Administraci√≥n</div></div>
      
    </div>
  </div>

  <!-- clientsModule -->
  <div id="clientsModule" class="frame hidden">
    <!-- Selector inicial -->
<div id="clientsHome" class="clients-home">
  <div class="home-grid">
    <!-- Nuevo Cliente -->
    <div id="btnNuevoCliente" class="choice-card" role="button" tabindex="0" aria-label="Nuevo cliente">
      <!-- icono apret√≥n de manos -->
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M12 12l3 3a2 2 0 1 1-3 3l-2-2-1 1a2 2 0 1 1-3-3l1-1-1-1a2 2 0 0 1 3-3l1 1 1-1a2 2 0 1 1 3 3l-2 2z"/>
        <path d="M18 8l3-3M6 8 3 5"/>
      </svg>
      <div class="choice-label">NUEVO CLIENTE</div>
    </div>

    <!-- Clientes -->
    <div id="btnVerClientes" class="choice-card" role="button" tabindex="0" aria-label="Clientes">
      <!-- icono grupo de personas -->
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
        <circle cx="9" cy="7" r="3"/>
        <path d="M22 21v-2a4 4 0 0 0-3-3.87M16 3.13a3 3 0 0 1 0 5.75"/>
      </svg>
      <div class="choice-label">CLIENTES</div>
    </div>
  </div>
</div>
 <div class="home-actions">
    <button id="btnClientesBack" class="btn">Volver</button>
  </div>
  <div id="clientsMenu" class="clients-menu hidden">
     <h2 id="tituloCliente" style="text-align:center;margin-bottom:16px;">Nuevo Cliente</h2>
      <div class="sub-tabs">
        <div class="sub-tab active" data-content="tab-datos">Datos Generales</div>
        <div class="sub-tab" data-content="tab-docs">Documentaci√≥n</div>
        <div class="sub-tab" data-content="tab-tarifas">Tarifas</div>
        <div class="sub-tab" data-content="tab-comentario">Comentarios</div>
      </div>

      <div id="tab-datos" class="sub-content active">
        <h3 class="section-title">Datos Generales</h3>
        <div class="form-group"><label>Nombre / Raz√≥n Social</label><input type="text" id="inpNombre"></div>
        <div class="form-group"><label>Estatus</label><select id="selEstatus"><option>Activo</option><option>Inactivo</option></select></div>
        <div class="form-group"><label>RFC</label><input type="text" id="inpRFC"></div>
        <div class="form-group"><label>Direcci√≥n</label><textarea id="txtDireccion" style="width:100%;height:70px;border:2px solid #ccc;border-radius:6px;"></textarea></div>
        <h3 class="section-title">Contactos</h3>
<div class="form-group">
  <label>Operaciones</label>
  <input type="text" placeholder="Email">
  <input type="email" placeholder="Nombre">
  <input type="text" placeholder="Tel.">
</div>
<div class="form-group">
  <label>Administraci√≥n</label>
  <input type="text" placeholder="Email">
  <input type="email" placeholder="Nombre">
  <input type="text" placeholder="Tel.">
</div>
<div class="form-group">
  <label>Comercial</label>
  <input type="text" placeholder="Email">
  <input type="email" placeholder="Nombre">
  <input type="text" placeholder="Tel.">
</div>
 </div>       

      <div id="tab-docs" class="sub-content">
        <h3 class="section-title">Documentaci√≥n</h3>
        <div class="doc-table-wrapper">
          <table class="doc-table">
            <thead>
              <tr><th>Comprobante</th><th>Estatus</th><th>Documento</th></tr>
            </thead>
            <tbody>
              <tr>
                <td><span class="icon-btn folder" data-row="1">üìÅ</span><span class="icon-btn view" data-row="1">üîç</span><input type="file" id="file1"/></td>
                <td id="status1" class="status-no">‚ùå No</td><td>Acta Constitutiva</td>
              </tr>
              <tr>
                <td><span class="icon-btn folder" data-row="2">üìÅ</span><span class="icon-btn view" data-row="2">üîç</span><input type="file" id="file2"/></td>
                <td id="status2" class="status-no">‚ùå No</td><td>Poder Rep. Legal</td>
              </tr>
              <tr>
                <td><span class="icon-btn folder" data-row="3">üìÅ</span><span class="icon-btn view" data-row="3">üîç</span><input type="file" id="file3"/></td>
                <td id="status3" class="status-no">‚ùå No</td><td>Comprobante de Domicilio</td>
              </tr>
              <tr>
                <td><span class="icon-btn folder" data-row="4">üìÅ</span><span class="icon-btn view" data-row="4">üîç</span><input type="file" id="file4"/></td>
                <td id="status4" class="status-no">‚ùå No</td><td>Constancia de Situaci√≥n Fiscal</td>
              </tr>
              <tr>
                <td><span class="icon-btn folder" data-row="5">üìÅ</span><span class="icon-btn view" data-row="5">üîç</span><input type="file" id="file5"/></td>
                <td id="status5" class="status-no">‚ùå No</td><td>INE Rep. Legal</td>
              </tr>
              <tr>
                <td><span class="icon-btn folder" data-row="6">üìÅ</span><span class="icon-btn view" data-row="6">üîç</span><input type="file" id="file6"/></td>
                <td id="status6" class="status-no">‚ùå No</td><td>Contrato</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div id="tab-tarifas" class="sub-content"><h3 class="section-title">Tarifas</h3>
        <button class="btn add-route">+ Agregar Ruta/Tarifa</button>
        <div class="doc-table-wrapper" style="max-height:250px; overflow-y:auto;">
          <table class="doc-table" id="tablaTarifas">
            <thead>
              <tr>
                <th>Origen - Destino</th>
                <th>Tipo de Unidad</th>
                <th>Tarifa</th>
                <th>D√≠as de Cr√©dito</th>
                <th>Km a recorrer</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <!-- Filas generadas din√°micamente -->
            </tbody>
          </table>
        </div>

        <!-- Modal -->
        <div id="tarifaModal" class="modal hidden">
          <div class="modal-content">
            <span class="close" title="Cerrar">&times;</span>
            <h3>Agregar Nueva Ruta/Tarifa</h3>

            <div class="form-row">
              <div class="form-group">
                <label for="estadoOrigen">Estado de Origen*</label>
                <select id="estadoOrigen" name="estadoOrigen" required>
                  <option value="">Seleccione un estado...</option>
                  <option value="Aguascalientes">Aguascalientes</option>
                  <option value="Baja California">Baja California</option>
                  <option value="Baja California Sur">Baja California Sur</option>
                  <option value="Campeche">Campeche</option>
                  <option value="Coahuila">Coahuila</option>
                  <option value="Colima">Colima</option>
                  <option value="Chiapas">Chiapas</option>
                  <option value="Chihuahua">Chihuahua</option>
                  <option value="Ciudad de M√©xico">Ciudad de M√©xico</option>
                  <option value="Durango">Durango</option>
                  <option value="Guanajuato">Guanajuato</option>
                  <option value="Guerrero">Guerrero</option>
                  <option value="Hidalgo">Hidalgo</option>
                  <option value="Jalisco">Jalisco</option>
                  <option value="Estado de M√©xico">Estado de M√©xico</option>
                  <option value="Michoac√°n">Michoac√°n</option>
                  <option value="Morelos">Morelos</option>
                  <option value="Nayarit">Nayarit</option>
                  <option value="Nuevo Le√≥n">Nuevo Le√≥n</option>
                  <option value="Oaxaca">Oaxaca</option>
                  <option value="Puebla">Puebla</option>
                  <option value="Quer√©taro">Quer√©taro</option>
                  <option value="Quintana Roo">Quintana Roo</option>
                  <option value="San Luis Potos√≠">San Luis Potos√≠</option>
                  <option value="Sinaloa">Sinaloa</option>
                  <option value="Sonora">Sonora</option>
                  <option value="Tabasco">Tabasco</option>
                  <option value="Tamaulipas">Tamaulipas</option>
                  <option value="Tlaxcala">Tlaxcala</option>
                  <option value="Veracruz">Veracruz</option>
                  <option value="Yucat√°n">Yucat√°n</option>
                  <option value="Zacatecas">Zacatecas</option>
                </select>
              </div>

              <div class="form-group">
                <label for="municipioOrigen">Municipio de Origen</label>
                <input type="text" id="municipioOrigen" placeholder="Opcional">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="estadoDestino">Estado de Destino*</label>
                <select id="estadoDestino" name="estadoDestino" required>
                  <option value="">Seleccione un estado...</option>
                  <option value="Aguascalientes">Aguascalientes</option>
                  <option value="Baja California">Baja California</option>
                  <option value="Baja California Sur">Baja California Sur</option>
                  <option value="Campeche">Campeche</option>
                  <option value="Coahuila">Coahuila</option>
                  <option value="Colima">Colima</option>
                  <option value="Chiapas">Chiapas</option>
                  <option value="Chihuahua">Chihuahua</option>
                  <option value="Ciudad de M√©xico">Ciudad de M√©xico</option>
                  <option value="Durango">Durango</option>
                  <option value="Guanajuato">Guanajuato</option>
                  <option value="Guerrero">Guerrero</option>
                  <option value="Hidalgo">Hidalgo</option>
                  <option value="Jalisco">Jalisco</option>
                  <option value="Estado de M√©xico">Estado de M√©xico</option>
                  <option value="Michoac√°n">Michoac√°n</option>
                  <option value="Morelos">Morelos</option>
                  <option value="Nayarit">Nayarit</option>
                  <option value="Nuevo Le√≥n">Nuevo Le√≥n</option>
                  <option value="Oaxaca">Oaxaca</option>
                  <option value="Puebla">Puebla</option>
                  <option value="Quer√©taro">Quer√©taro</option>
                  <option value="Quintana Roo">Quintana Roo</option>
                  <option value="San Luis Potos√≠">San Luis Potos√≠</option>
                  <option value="Sinaloa">Sinaloa</option>
                  <option value="Sonora">Sonora</option>
                  <option value="Tabasco">Tabasco</option>
                  <option value="Tamaulipas">Tamaulipas</option>
                  <option value="Tlaxcala">Tlaxcala</option>
                  <option value="Veracruz">Veracruz</option>
                  <option value="Yucat√°n">Yucat√°n</option>
                  <option value="Zacatecas">Zacatecas</option>
                </select>
              </div>
              <div class="form-group">
                <label for="municipioDestino">Municipio de Destino</label>
                <input type="text" id="municipioDestino" placeholder="Opcional">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group form-group-full">
                <label for="tipoUnidad">Tipo de unidad*</label>
                <select id="tipoUnidad" required>
                  <option value="">Seleccione...</option>
                  <option value="Unidad seca de 53">Unidad seca de 53"</option>
                  <option value="Refrigerada de 53">Refrigerada de 53"</option>
                  <option value="Thorton">Thorton</option>
                  <option value="3.5">3.5</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="diasCredito">D√≠as de Cr√©dito</label>
                <input type="number" id="diasCredito" min="0" placeholder="0">
              </div>
              <div class="form-group">
                <label for="kmRecorrer">Km a recorrer</label>
                <input type="number" id="kmRecorrer" min="0" placeholder="0">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="tarifa">Tarifa*</label>
                <input type="number" id="tarifa" min="0" step="0.01" required placeholder="0.00">
              </div>
            </div>

            <div class="modal-buttons">
              <button type="button" class="btn-cancelar">Cancelar</button>
              <button type="button" class="btn-guardar">Guardar</button>
            </div>
          </div>
        </div>
        <!-- /Modal -->
      </div>

      <div id="tab-comentario" class="sub-content">
        <h3 class="section-title">Comentarios</h3>
            <div class="form-group"><label>Comentario</label><textarea id="txtComentario" style="width:100%;height:120px;border:2px solid #ccc;border-radius:6px;"></textarea></div>
      </div>

      <div class="button-row">
  <button id="saveClient">Guardar</button>
  <button id="exitClient">Salir</button>
</div>
    </div>
    <!-- NUEVA VENTANA: Lista de Clientes -->
<div id="clientsList" class="clients-menu clients-list hidden" aria-label="Lista de clientes">
  <div class="list-toolbar">
    <div><h3>Clientes registrados</h3></div>
    <div class="search">
      <label for="searchCli">Buscar:</label>
      <input id="searchCli" type="text" placeholder="Nombre, RFC‚Ä¶">
    </div>
    <div class="list-actions">
      <button id="btnNuevoDesdeLista" class="btn primary">+ Nuevo Cliente</button>
      <button id="btnVolverHome" class="btn">Volver</button>
      <button id="btnImportExcel" class="btn">Importar Excel</button>
      <input id="excelInput" type="file" accept=".xlsx,.xls" style="display:none">
    </div>
  </div>

  <div class="doc-table-wrapper" style="max-height:300px; overflow:auto;">
    <table class="doc-table" id="tablaClientes">
      <thead>
        <tr>
          <th>ID Cliente</th>
          <th>Nombre/Raz√≥n Social</th>
          <th>RFC</th>
          <th>Estatus</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody><!-- filas din√°micas --></tbody>
    </table>
  </div>
</div>

  </div>



      
<!-- Inicio Mod 2 -->
<div id="permModule" class="frame hidden" aria-label="M√≥dulo Permisionarios">

  <!-- Ventana: Permisionarios registrados -->

<div id="permsList" class="clients-menu perms-list" aria-label="Permisionarios registrados">
  <div class="list-toolbar">
    <div><h3>Permisionarios registrados</h3></div>
    <div class="search">
      <label for="searchPerm">Buscar:</label>
     <input id="searchPerm" type="text" placeholder="ID, Nombre o RFC‚Ä¶">
    </div>
    <div class="list-actions">
   <button id="btnPermNuevo" class="btn primary">+ Nuevo Permisionario</button>
      <button id="btnPermVolver" class="btn">Volver</button>
    </div>
  </div>

  
  <div class="doc-table-wrapper" style="max-height:300px; overflow:auto;">
    <table class="doc-table" id="tablaPerms">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre/Raz√≥n Social</th>
          <th>Estatus</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody><!-- filas din√°micas --></tbody>
    </table>
  </div>
</div>
  <!-- Men√∫/Formulario: Nuevo Permisionario -->
<div id="permsMenu" class="frame hidden" aria-label="Nuevo Permisionario">
  <h3>Nuevo Permisionario</h3>

  <div class="subtabs" role="tablist" aria-label="Subpesta√±as Permisionarios">
    <div class="subtab active" data-target="perm-datos" role="tab" aria-selected="true">Datos</div>
    <div class="subtab" data-target="perm-docs" role="tab">Documentos</div>
    <div class="subtab" data-target="perm-unidades" role="tab">Unidades</div>
    <div class="subtab" data-target="perm-coment" role="tab">Operadores</div>
  </div>



  <!-- Subcontenido: Datos -->
  <div id="perm-datos" class="subcontent active">
    <div class="form-row">
      <div class="fld">
        <label for="permNombre">Nombre/Raz√≥n social</label>
        <input id="permNombre" type="text" placeholder="Permisionario S.A. de C.V.">
      </div>
      <div class="fld">
        <label for="permRFC">RFC</label>
        <input id="permRFC" type="text" placeholder="XXXX010101XXX">
      </div>
    </div>
    <div class="form-row">
      <div class="fld">
        <label for="permEstatus">Estatus</label>
        <select id="permEstatus">
          <option value="Activo">Activo</option>
          <option value="Inactivo">Inactivo</option>
        </select>
      </div>
      <div class="fld">
        <label for="permContacto">Domicilio</label>
        <input id="permContacto" type="text" placeholder="Nombre de contacto">
      </div>
    </div>
    <h3 class="section-title">Contactos</h3>
    <div class="form-group">
      <label>Operaciones</label>
      <input type="text" placeholder="Email">
      <input type="email" placeholder="Nombre">
      <input type="text" placeholder="Tel.">
    </div>
    <div class="form-group">
      <label>Administraci√≥n</label>
      <input type="text" placeholder="Email">
      <input type="email" placeholder="Nombre">
      <input type="text" placeholder="Tel.">
    </div>
    <div class="form-group">
      <label>Comercial</label>
      <input type="text" placeholder="Email">
      <input type="email" placeholder="Nombre">
      <input type="text" placeholder="Tel.">
    </div>
  </div>

  <!-- Subcontenido: Documentos -->
  <div id="perm-docs" class="subcontent">
       <h3 class="section-title">Documentaci√≥n</h3>
    <div class="doc-table-wrapper">
      <table class="doc-table">
        <thead>
          <tr><th>Comprobante</th><th>Estatus</th><th>Documento</th></tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="icon-btn perm-folder" data-row="1">üìÅ</span><span class="icon-btn perm-view" data-row="1">üîç</span><input type="file" id="permFile1"/></td>
            <td id="permStatus1" class="status-no">‚ùå No</td><td>Acta Constitutiva</td>
          </tr>
          <tr>
            <td><span class="icon-btn perm-folder" data-row="2">üìÅ</span><span class="icon-btn perm-view" data-row="2">üîç</span><input type="file" id="permFile2"/></td>
            <td id="permStatus2" class="status-no">‚ùå No</td><td>Poder Rep. Legal</td>
          </tr>
          <tr>
            <td><span class="icon-btn perm-folder" data-row="3">üìÅ</span><span class="icon-btn perm-view" data-row="3">üîç</span><input type="file" id="permFile3"/></td>
            <td id="permStatus3" class="status-no">‚ùå No</td><td>Comprobante de Domicilio</td>
          </tr>
          <tr>
            <td><span class="icon-btn perm-folder" data-row="4">üìÅ</span><span class="icon-btn perm-view" data-row="4">üîç</span><input type="file" id="permFile4"/></td>
            <td id="permStatus4" class="status-no">‚ùå No</td><td>Constancia de Situaci√≥n Fiscal</td>
          </tr>
          <tr>
            <td><span class="icon-btn perm-folder" data-row="5">üìÅ</span><span class="icon-btn perm-view" data-row="5">üîç</span><input type="file" id="permFile5"/></td>
            <td id="permStatus5" class="status-no">‚ùå No</td><td>INE Rep. Legal</td>
          </tr>
          <tr>
            <td><span class="icon-btn perm-folder" data-row="6">üìÅ</span><span class="icon-btn perm-view" data-row="6">üîç</span><input type="file" id="permFile6"/></td>
            <td id="permStatus6" class="status-no">‚ùå No</td><td>Contrato</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Subcontenido: Unidades -->
  <div id="perm-unidades" class="subcontent">
    <h3 class="section-title">Unidades</h3>
    <button class="btn add-unit">+ Agregar Unidad</button>

  <div class="doc-table-wrapper" style="max-height:250px; overflow-y:auto;">
    <table class="doc-table" id="tablaUnidades">
      <thead>
        <tr>
          <th>Tarjeta de Circulaci√≥n</th>
          <th>Placas</th>
          <th>Eco</th>
          <th>Tipo</th>
          <th>Vencimiento Poliza</th>
          <th>Aseguradora</th>
          <th>Marca</th>
          <th>A√±o</th>
          <th>Permiso SCT</th>
          <th>Acciones</th>    
          
          
          
        </tr>
      </thead>
      <tbody>
        <!-- Filas generadas din√°micamente -->

      
      </tbody>
    </table>
    <div id="unidadModal" class="modal hidden" aria-hidden="true">
  <div class="modal-content" style="min-width: 720px;">
    <span class="close" title="Cerrar">&times;</span>
    <h3>Alta de Unidad Vehicular</h3>

    <div class="form-row">
      <div class="form-group">
  <label for="uTarjetaName">Tarjeta de Circulaci√≥n*</label>
  <div class="file-row" style="display:flex;align-items:center;gap:8px;">
    <button type="button" id="btnUTarjetaPick" class="icon-btn" title="Adjuntar">üìÅ</button>
    <input id="uTarjetaFile" type="file" accept=".pdf,.jpg,.jpeg,.png" required>
    <input id="uTarjetaName" type="text" placeholder="Selecciona un archivo‚Ä¶" readonly required>
    <!-- compatibilidad con c√≥digo previo: refleja el nombre en un input oculto con id=uTarjeta -->
    <input id="uTarjeta" type="hidden" value="">
  
<div class="field-error" data-for="uTarjetaName"></div></div>
</div>
      <div class="form-group">
        <label for="uPlacas">Placas*</label>
        <input id="uPlacas" type="text" placeholder="ABC123A" required>
      </div>
    </div>
        

    <div class="form-row">
      <div class="form-group">
        <label for="uEco">Eco</label>
        <input id="uEco" type="text" placeholder="Econ√≥mico interno">
      </div>
      <div class="form-group">
        <label for="uTipo">Tipo*</label>
        <select id="uTipo" required>
          <option value="">Seleccione‚Ä¶</option>
          <option>Tractor</option>
          <option>Unidad seca 53"</option>
          <option>Refrigerada 53"</option>
          <option>Thorton</option>
          <option>3.5</option>
          <option>Torton</option>
          <option>Rab√≥n</option>
        </select>
      
<div class="field-error" data-for="uTipo"></div></div>
    </div>

        
    <div class="form-row">
        <div class="form-group">
        <label for="uAseguradora">Aseguradora</label>
        <input id="uAseguradora" type="text" placeholder="Nombre de aseguradora">
      </div>
      <div class="form-group">
        <label for="uVencePoliza">Vencimiento P√≥liza</label>
        <input id="uVencePoliza" type="date">
      </div>
<div class="form-group">
  <label for="uPolizaName">P√≥liza de Seguro</label>
  <div class="file-row" style="display:flex;align-items:center;gap:8px;">
    <button type="button" id="btnUPolizaPick" class="icon-btn" title="Adjuntar p√≥liza" aria-label="Adjuntar p√≥liza">üìÅ</button>
    <input id="uPolizaFile" type="file" accept="application/pdf,image/*" required style="display:none">
    <input id="uPolizaName" type="text" placeholder="Selecciona un archivo‚Ä¶" readonly autocomplete="off">
    <input id="uPoliza" type="hidden" value="">
  
<div class="field-error" data-for="uPolizaName"></div></div>
</div>
      <div class="form-group">
        <label for="uAseguradora">Aseguradora</label>
        <input id="uAseguradora" type="text" placeholder="Nombre de aseguradora">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="uMarca">Marca</label>
        <input id="uMarca" type="text" placeholder="Kenworth / Freightliner‚Ä¶">
      </div>
      <div class="form-group">
        <label for="uAnio">A√±o</label>
        <input id="uAnio" type="number" min="1980" max="2100" placeholder="2022">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group form-group-full">
        <label for="uPermisoSCT">Permiso SCT</label>
        <input id="uPermisoSCT" type="text" placeholder="N√∫mero de permiso SCT">
      </div>
    </div>

    <div class="modal-buttons">
      <button type="button" class="btn-cancelar">Cancelar</button>
      <button type="button" class="btn-guardar">Guardar</button>
    </div>
  </div>
</div>
  </div>

  </div>

  <!-- Subcontenido: Operadores -->
  <div id="perm-coment" class="subcontent">
    <h3 class="section-title">Operadores</h3>
    <button class="btn add-operator">+ Agregar Operador</button>

    <div class="doc-table-wrapper" style="max-height:250px; overflow-y:auto;">
      <table class="doc-table" id="tablaOperadores">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>N√∫mero de Licencia</th>
            <th>Licencia</th>
            <th>Vto de Licencia</th>
            <th>Apto M√©dico</th>
            <th>Vto de apto.</th>
            <th>RFC</th>
          </tr>
        </thead>
        <tbody>
          <!-- Filas generadas din√°micamente -->
        </tbody>
      </table>
     
      <div id="operadorModal" class="modal hidden" aria-hidden="true">
        <div class="modal-content" style="min-width:480px;">
          <span class="close" title="Cerrar">&times;</span>
          <h3>Agregar Operador</h3>

          <div class="form-row">
            <div class="form-group">
              <label for="opNombre">Nombre</label>
              <input id="opNombre" type="text">
            </div>
            <div class="form-group">
              <label for="opNumeroLicencia">N√∫mero de Licencia</label>
              <input id="opNumeroLicencia" type="text">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="opLicencia">Licencia</label>
              <input id="opLicencia" type="text">
            </div>
            <div class="form-group">
              <label for="opVtoLicencia">Vto de Licencia</label>
              <input id="opVtoLicencia" type="date">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="opAptoMedico">Apto M√©dico</label>
              <input id="opAptoMedico" type="text">
            </div>
            <div class="form-group">
              <label for="opVtoApto">Vto apto</label>
              <input id="opVtoApto" type="date">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group form-group-full">
              <label for="opRFC">RFC</label>
              <input id="opRFC" type="text">
            </div>
          </div>

          <div class="modal-buttons">
            <button type="button" class="btn-cancelar">Cancelar</button>
            <button type="button" class="btn-guardar">Guardar</button>
            </div>
        </div>
      </div>     
    </div>
  </div>
  <div class="actions-bar">
    <button id="btnPermCancelar" class="btn">Cancelar</button>
       <button id="btnPermGuardar" class="btn">Guardar Permisionario</button>
    <button id="btnPermVolverPostSave" class="btn ghost" style="display:none">Volver</button>
 </div>     
</div>    
      
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
      
        

  
  

   
 <script>
      //Login y Men√∫ principal 
window.addEventListener('DOMContentLoaded', () => {
  // --- Usuarios v√°lidos (puedes agregar m√°s aqu√≠)
  const usuarios = [
    {usuario:"David Vargas R.", password:"1234"}
  ];

  // --- Mostrar secci√≥n (frame)
  function showSection(id) {
    document.querySelectorAll('.frame').forEach(f => f.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
  }

  // --- Rellenar usuario si existe en localStorage
  const last = localStorage.getItem('sr_last_user');
  if (last) document.getElementById('usuario').value = last;

  // --- Bot√≥n guardar usuario
  document.getElementById('btnGuardar').onclick = () => {
    localStorage.setItem('sr_last_user', document.getElementById('usuario').value);
    alert('Usuario guardado');
  };

  // --- Login
  document.getElementById('btnEntrar').onclick = () => {
    const u = document.getElementById('usuario').value;
    const p = document.getElementById('password').value;
    if (usuarios.find(x => x.usuario === u && x.password === p)) {
      showSection('dashboard');
    } else {
      alert('Usuario o contrase√±a incorrectos');
    }
  };

  // --- Sub-tabs (clientes)
  document.querySelectorAll('.sub-tab').forEach(tab => {
    tab.onclick = () => {
      document.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.sub-content').forEach(c => c.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById(tab.dataset.content).classList.add('active');
    };
  });

  // --- Navegaci√≥n principal desde dashboard
  document.getElementById('modClientes').onclick = () => {
    showSection('clientsModule');
    document.getElementById('clientsHome')?.classList.remove('hidden');
    document.getElementById('clientsMenu')?.classList.add('hidden');
    document.getElementById('clientsList')?.classList.add('hidden');
  };
  document.getElementById('modPerm').onclick = () => {
    showSection('permModule');
    if (typeof renderTablaPerms === 'function') renderTablaPerms();
  };
  document.getElementById('btnClientesBack')?.addEventListener('click', () => {
    showSection('dashboard');
  });
  document.getElementById('btnPermVolver')?.addEventListener('click', () => {
    showSection('dashboard');
  });

  // --- Puedes agregar aqu√≠ otros m√≥dulos del dashboard si tienes m√°s botones
});

 </script>   



      
<script>
            //aqui empieza el modulo de clientes
window.addEventListener('DOMContentLoaded', () => {
  // === Referencias principales
  const clientsHome = document.getElementById('clientsHome');
  const clientsMenu = document.getElementById('clientsMenu');
  const clientsList = document.getElementById('clientsList');
  const srStoreKey = 'sr_clientes';
  let editingClientId = null;

  // === Helpers de vistas
  function showInClientsModule(el){
    [clientsHome, clientsMenu, clientsList].forEach(x => x && x.classList.add('hidden'));
    el && el.classList.remove('hidden');
  }

  // === BD local de clientes
  function getClientes(){ try { return JSON.parse(localStorage.getItem(srStoreKey)) || []; } catch { return []; } }
  function setClientes(arr){ localStorage.setItem(srStoreKey, JSON.stringify(arr)); }

  // === Render tabla clientes
  function renderTablaClientes(filtro=''){
    const tbody = document.querySelector('#tablaClientes tbody');
    if(!tbody) return;
    const data = getClientes();
    const q = (filtro||'').toLowerCase();
    const fil = data.filter(c =>
      (!q) || (c.nombre?.toLowerCase().includes(q) || c.rfc?.toLowerCase().includes(q) || String(c.id||'').toLowerCase().includes(q))
    );
    tbody.innerHTML = fil.map(c => `
      <tr>
        <td><span class="client-id-link" data-id="${c.id}">${c.id || ''}</span></td>
        <td>${c.nombre || ''}</td>
        <td>${c.rfc || ''}</td>
        <td>${c.estatus || 'Activo'}</td>
        <td class="actions">
          <span class="icon-btn btnEdit" title="Editar" data-id="${c.id}">‚úèÔ∏è</span>
          <span class="icon-btn btnDelete" title="Eliminar" data-id="${c.id}">üóëÔ∏è</span>
        </td>
      </tr>
    `).join('') || `<tr><td colspan="5">Sin registros</td></tr>`;
    // Listeners de acciones
    tbody.querySelectorAll('.btnDelete').forEach(btn => {
      btn.addEventListener('click', () => openDeleteModal(btn.dataset.id));
    });
    tbody.querySelectorAll('.btnEdit').forEach(btn => {
      btn.addEventListener('click', () => editCliente(btn.dataset.id));
    });
    tbody.querySelectorAll('.client-id-link').forEach(link => {
      link.addEventListener('click', () => mostrarDetalleCliente(link.dataset.id));
    });
  }
 document.getElementById('btnImportExcel')?.addEventListener('click', () => {
  document.getElementById('excelInput')?.click();
});     
//Codigo para importar excel 
excelInput?.addEventListener('change', (event) => {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    const data = new Uint8Array(e.target.result);
    const workbook = XLSX.read(data, {type: 'array'});

    // Procesar Hoja Clientes
    const clientesSheet = workbook.Sheets['Clientes'];
    const clientesJson = XLSX.utils.sheet_to_json(clientesSheet, {header:1});
    // Procesar Hoja Tarifas
    const tarifasSheet = workbook.Sheets['Tarifas'];
    const tarifasJson = XLSX.utils.sheet_to_json(tarifasSheet, {header:1});

    // Mapear encabezados de Clientes
    const clientesHeaders = clientesJson[0];
    const clientesData = clientesJson.slice(1);
    let clientesArr = [];

    clientesData.forEach(row => {
      // Empareja cada encabezado con su valor
      const obj = {};
      clientesHeaders.forEach((h, idx) => {
        obj[h] = row[idx] || '';
      });
      clientesArr.push({
        id: '', // Se puede generar despu√©s
        nombre: obj['Nombre / Raz√≥n Social'] || '',
        rfc: obj['RFC'] || '',
        estatus: obj['Estatus'] || '',
        domicilio: obj['Domicilio'] || '',
        operaciones: {
          nombre: obj['Contacto Operaciones (Nombre)'] || '',
          email: obj['Contacto Operaciones (Email)'] || '',
          tel: obj['Contacto Operaciones (Tel)'] || ''
        },
        administracion: {
          nombre: obj['Contacto Administraci√≥n (Nombre)'] || '',
          email: obj['Contacto Administraci√≥n (Email)'] || '',
          tel: obj['Contacto Administraci√≥n (Tel)'] || ''
        },
        comercial: {
          nombre: obj['Contacto Comercial (Nombre)'] || '',
          email: obj['Contacto Comercial (Email)'] || '',
          tel: obj['Contacto Comercial (Tel)'] || ''
        },
        tarifas: [] // Se llenar√° despu√©s
      });
    
    });

    // Mapear encabezados de Tarifas
    const tarifasHeaders = tarifasJson[0];
    const tarifasData = tarifasJson.slice(1);

    tarifasData.forEach(row => {
      const obj = {};
      tarifasHeaders.forEach((h, idx) => {
        obj[h] = row[idx] || '';
      });
      // Busca el cliente por RFC y agrega la tarifa
      const cliente = clientesArr.find(c => c.rfc === obj['RFC']);
      if (cliente) {
        cliente.tarifas = cliente.tarifas || [];
        cliente.tarifas.push({
          estadoOrigen: obj['Estado Origen'] || '',
          municipioOrigen: obj['Municipio Origen'] || '',
          estadoDestino: obj['Estado Destino'] || '',
          municipioDestino: obj['Municipio Destino'] || '',
          tipoUnidad: obj['Tipo Unidad'] || '',
          diasCredito: obj['Dias Credito'] || '',
          kmRecorrer: obj['Km Recorrer'] || '',
          tarifa: obj['Tarifa'] || ''
        });
      }
    });

    // Generar IDs autom√°ticos tipo LTR-CL-01, LTR-CL-02...
    const existing = getClientes();
    let nextId = existing.reduce((max, c) => {
      const match = /LTR-CL-(\d+)/.exec(c.id || '');
      return Math.max(max, match ? parseInt(match[1], 10) : 0);
    }, 0) + 1;

    clientesArr.forEach(c => {
      const idxExist = existing.findIndex(e => e.rfc === c.rfc);
      if (idxExist >= 0) {
        c.id = existing[idxExist].id;
        existing[idxExist] = c;
      } else {
        c.id = 'LTR-CL-' + String(nextId).padStart(2, '0');
        existing.push(c);
        nextId++;
      }
    });

    // Establece clientes SOLO UNA VEZ, fuera del bucle
    setClientes(existing);
    alert('Clientes y tarifas importados correctamente.');
    if (typeof renderTablaClientes === 'function') renderTablaClientes();
  };
  reader.readAsArrayBuffer(file);
});
  // === Eliminar cliente
  const confirmDeleteModal = document.getElementById('confirmDeleteModal');
  const deleteConfirmYes = document.getElementById('deleteConfirmYes');
  const deleteConfirmNo  = document.getElementById('deleteConfirmNo');
  let deleteId = null;
  function openDeleteModal(id){
    deleteId = id;
    confirmDeleteModal.classList.remove('hidden');
    confirmDeleteModal.style.display = 'flex';
  }
  function closeDeleteModal(){
    confirmDeleteModal.classList.add('hidden');
    confirmDeleteModal.style.display = 'none';
    deleteId = null;
  }
  deleteConfirmYes?.addEventListener('click', () => {
    if(deleteId){
      const arr = getClientes();
      const idx = arr.findIndex(c => c.id === deleteId);
      if(idx >= 0){
        arr.splice(idx,1);
        setClientes(arr);
        renderTablaClientes();
      }
    }
    closeDeleteModal();
  });
  deleteConfirmNo?.addEventListener('click', closeDeleteModal);
  confirmDeleteModal?.querySelector('.close')?.addEventListener('click', closeDeleteModal);
  window.addEventListener('click', e => { if(e.target === confirmDeleteModal) closeDeleteModal(); });

  // === Editar cliente
  function editCliente(id){
    const cliente = getClientes().find(c => c.id === id);
    if(!cliente) return;
    editingClientId = id;
    document.getElementById('tituloCliente').textContent = 'Editar Cliente';
    showInClientsModule(clientsMenu);
    document.querySelector('.sub-tab[data-content="tab-datos"]')?.click();
    limpiarFormularioCliente();
    document.getElementById('inpNombre').value = cliente.nombre || '';
    document.getElementById('selEstatus').value = cliente.estatus || 'Activo';
    document.getElementById('inpRFC').value = cliente.rfc || '';
    document.getElementById('txtDireccion').value = cliente.domicilio || '';
    document.getElementById('txtComentario').value = cliente.comentario || '';
    (cliente.docs || []).forEach((doc, idx) => {
      const st = document.getElementById(`status${idx+1}`);
      if(st){
        if(doc.estatus){
          st.textContent = '‚úÖ S√≠';
          st.classList.remove('status-no');
          st.classList.add('status-yes');
        } else {
          st.textContent = '‚ùå No';
          st.classList.remove('status-yes');
          st.classList.add('status-no');
        }
      }
    });
    const tarifasBody = document.querySelector('#tablaTarifas tbody');
    if(tarifasBody){
      tarifasBody.innerHTML = '';
      (cliente.tarifas || []).forEach(t => {
        const tr = document.createElement('tr');
        tr.dataset.info = JSON.stringify(t);
        const cOrigenDestino = `${t.estadoOrigen} - ${t.estadoDestino}`;
        const cTipo = t.tipoUnidad;
        const cTarifa = Number(t.tarifa).toLocaleString('es-MX', {style:'currency', currency:'MXN'});
        const cCred  = t.diasCredito || 0;
        const cKm    = t.kmRecorrer || 0;
        tr.innerHTML = `
        <td>${cOrigenDestino}</td>
        <td>${cTipo}</td>
        <td>${cTarifa}</td>
        <td>${cCred}</td>
        <td>${cKm}</td>
        <td><span class="icon-btn edit-tarifa" title="Editar">‚úèÔ∏è</span></td>`;
        tarifasBody.appendChild(tr);
      });
    }
  }

  // === Limpiar formulario
  function limpiarFormularioCliente(){
    if(!clientsMenu) return;
    clientsMenu.querySelectorAll('input, textarea').forEach(el => {
      el.value = '';
      if(el.type === 'file'){ el.value = ''; }
    });
    clientsMenu.querySelectorAll('select').forEach(sel => sel.selectedIndex = 0);
    clientsMenu.querySelectorAll('.status').forEach(st => {
      st.textContent = '‚ùå No';
      st.classList.remove('status-yes');
      st.classList.add('status-no');
    });
    const tarifasBody = document.querySelector('#tablaTarifas tbody');
    if(tarifasBody) tarifasBody.innerHTML = '';
  }

  // === Bot√≥n ‚ÄúNuevo Cliente‚Äù
  document.getElementById('btnNuevoCliente')?.addEventListener('click', () => {
    editingClientId = null;
    limpiarFormularioCliente();
    document.getElementById('tituloCliente').textContent = 'Nuevo Cliente';
    showInClientsModule(clientsMenu);
    document.querySelector('.sub-tab[data-content="tab-datos"]')?.click();
  });

  // === Bot√≥n ‚ÄúCLIENTES‚Äù
  document.getElementById('btnVerClientes')?.addEventListener('click', () => {
    editingClientId = null;
    document.getElementById('tituloCliente').textContent = 'Nuevo Cliente';
    showInClientsModule(clientsList);
    renderTablaClientes();
    limpiarFormularioCliente();
  });

  // === Volver al dashboard desde clientes
  document.getElementById('btnClientesBack')?.addEventListener('click', () => {
    showSection('dashboard');
  });

  // === Botones dentro de la ventana ‚ÄúClientes‚Äù
  document.getElementById('btnVolverHome')?.addEventListener('click', () => {
    editingClientId = null;
    document.getElementById('tituloCliente').textContent = 'Nuevo Cliente';
    showInClientsModule(clientsHome);
  });
  document.getElementById('btnNuevoDesdeLista')?.addEventListener('click', () => {
    editingClientId = null;
    limpiarFormularioCliente();
    document.getElementById('tituloCliente').textContent = 'Nuevo Cliente';
    showInClientsModule(clientsMenu);
    document.querySelector('.sub-tab[data-content="tab-datos"]')?.click();
  });

  // === B√∫squeda en la lista
  document.getElementById('searchCli')?.addEventListener('input', (e) => {
    renderTablaClientes(e.target.value);
  });

  // === Salir del men√∫ de cliente
  document.getElementById('exitClient').onclick = () => showSection('dashboard');

  // === Mostrar/ocultar bot√≥n Guardar seg√∫n la pesta√±a activa
  const saveBtn = document.getElementById('saveClient');
  function updateSaveButtonVisibility() {
    const activeTab = document.querySelector('.sub-tab.active');
    if (activeTab && activeTab.dataset.content === 'tab-comentario') {
      saveBtn.style.display = 'inline-block';
    } else {
      saveBtn.style.display = 'none';
    }
  }
  updateSaveButtonVisibility();
  document.querySelectorAll('.sub-tab').forEach(tab => {
    tab.addEventListener('click', updateSaveButtonVisibility);
  });

  // === Guardar cliente y mostrar confirmaci√≥n
  const clienteModal = document.getElementById('clienteModal');
  const clienteModalClose = clienteModal.querySelector('.close');
  const clienteModalBtnCerrar = clienteModal.querySelector('.btn-cerrar');

  function generarSiguienteId(arr) {
    const prefijo = 'LTR-CL-';
    const maxNum = arr.reduce((max, c) => {
      const m = (c.id || '').match(/^LTR-CL-(\d+)$/);
      const n = m ? parseInt(m[1], 10) : 0;
      return n > max ? n : max;
    }, 0);
    return `${prefijo}${String(maxNum + 1).padStart(2, '0')}`;
  }

  saveBtn.addEventListener('click', () => {
    const nombre = (document.getElementById('inpNombre')?.value || '').trim();
    const rfc = (document.getElementById('inpRFC')?.value || '').trim();
    const estatus = document.getElementById('selEstatus')?.value || 'Activo';
    const domicilio = (document.getElementById('txtDireccion')?.value || '').trim();
    const comentario = (document.getElementById('txtComentario')?.value || '').trim();

    const docNames = [
      'Acta Constitutiva',
      'Poder Rep. Legal',
      'Comprobante de Domicilio',
      'Constancia de Situaci√≥n Fiscal',
      'INE Rep. Legal',
      'Contrato'
    ];
    const docs = docNames.map((nombre, idx) => {
      const st = document.getElementById(`status${idx+1}`);
      return { nombre, estatus: st?.classList.contains('status-yes') };
    });

    const tarifas = Array.from(document.querySelectorAll('#tablaTarifas tbody tr')).map(tr => {
      try { return JSON.parse(tr.dataset.info || '{}'); } catch { return {}; }
    });

    if (!nombre || !rfc) {
      alert('Por favor llena al menos Nombre/Raz√≥n Social y RFC.');
      return;
    }

    const arr = getClientes();
    let id = editingClientId;
    if(editingClientId){
      const idx = arr.findIndex(c => c.id === editingClientId);
      if(idx >= 0){
        arr[idx] = { id: editingClientId, nombre, rfc, estatus, domicilio, comentario, docs, tarifas };
      }
    } else {
      id = generarSiguienteId(arr);
      arr.push({ id, nombre, rfc, estatus, domicilio, comentario, docs, tarifas });
    }
    setClientes(arr);

    renderTablaClientes();
    document.getElementById('idClienteTexto').textContent = id;
    document.getElementById('nombreCliente').textContent = nombre;
    document.getElementById('rfcCliente').textContent = rfc;
    document.getElementById('domicilioCliente').textContent = domicilio;
    clienteModal.classList.remove('hidden');
    clienteModal.style.display = 'flex';
    editingClientId = null;
    document.getElementById('tituloCliente').textContent = 'Nuevo Cliente';
  });

  // === Cerrar modal de confirmaci√≥n
  function cerrarClienteModal() {
    clienteModal.classList.add('hidden');
    clienteModal.style.display = 'none';
  }
  clienteModalClose.addEventListener('click', cerrarClienteModal);
  clienteModalBtnCerrar.addEventListener('click', cerrarClienteModal);
  window.addEventListener('click', (e) => {
    if (e.target === clienteModal) cerrarClienteModal();
  });

  // === Documentaci√≥n (folder, view)
  document.querySelectorAll('.folder').forEach(btn => {
    btn.onclick = () => {
      const row = btn.dataset.row;
      const inp = document.getElementById('file' + row);
      inp.click();
      inp.onchange = () => {
        const st = document.getElementById('status' + row);
        st.textContent = '‚úÖ S√≠';
        st.classList.remove('status-no');
        st.classList.add('status-yes');
      };
    };
  });
  document.querySelectorAll('.view').forEach(btn => {
    btn.onclick = () => {
      const row = btn.dataset.row;
      const inp = document.getElementById('file' + row);
      if (inp.files.length) {
        const url = URL.createObjectURL(inp.files[0]);
        window.open(url);
      } else {
        alert('No hay archivo cargado a√∫n');
      }
    };
  });

  // === Tarifas / Modal
  const modal = document.getElementById('tarifaModal');
  const tablaTarifas = document.querySelector('#tablaTarifas tbody');
  let editingRow = null;
  const tituloModal = modal.querySelector('h3');

  function mostrarModal() {
    modal.classList.remove('hidden');
    modal.style.display = 'flex';
  }
  function ocultarModal() {
    modal.classList.add('hidden');
    modal.style.display = 'none';
  }
  function activarTabTarifas() {
    document.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.sub-content').forEach(c => c.classList.remove('active'));
    document.querySelector('.sub-tab[data-content="tab-tarifas"]').classList.add('active');
    document.getElementById('tab-tarifas').classList.add('active');
  }
  function limpiarFormulario() {
    document.getElementById('estadoOrigen').value = '';
    document.getElementById('municipioOrigen').value = '';
    document.getElementById('estadoDestino').value = '';
    document.getElementById('municipioDestino').value = '';
    document.getElementById('tipoUnidad').selectedIndex = 0;
    document.getElementById('diasCredito').value = '';
    document.getElementById('kmRecorrer').value = '';
    document.getElementById('tarifa').value = '';
  }
  function cargarFormulario(datos) {
    document.getElementById('estadoOrigen').value   = datos.estadoOrigen || '';
    document.getElementById('municipioOrigen').value= datos.municipioOrigen || '';
    document.getElementById('estadoDestino').value  = datos.estadoDestino || '';
    document.getElementById('municipioDestino').value= datos.municipioDestino || '';
    document.getElementById('tipoUnidad').value     = datos.tipoUnidad || '';
    document.getElementById('diasCredito').value    = datos.diasCredito ?? '';
    document.getElementById('kmRecorrer').value     = datos.kmRecorrer ?? '';
    document.getElementById('tarifa').value         = datos.tarifa ?? '';
  }
  function guardarTarifa() {
    const datos = {
      estadoOrigen: document.getElementById('estadoOrigen').value.trim(),
      municipioOrigen: document.getElementById('municipioOrigen').value.trim(),
      estadoDestino: document.getElementById('estadoDestino').value.trim(),
      municipioDestino: document.getElementById('municipioDestino').value.trim(),
      tipoUnidad: document.getElementById('tipoUnidad').value,
      diasCredito: document.getElementById('diasCredito').value,
      kmRecorrer: document.getElementById('kmRecorrer').value,
      tarifa: document.getElementById('tarifa').value
    };
    if (!datos.estadoOrigen || !datos.estadoDestino || !datos.tipoUnidad || !datos.tarifa) {
      alert('Por favor complete todos los campos obligatorios (*)');
      return;
    }
    const cOrigenDestino = `${datos.estadoOrigen} - ${datos.estadoDestino}`;
    const cTipo = datos.tipoUnidad;
    const cTarifa = Number(datos.tarifa).toLocaleString('es-MX', {style:'currency', currency:'MXN'});
    const cCred  = datos.diasCredito || 0;
    const cKm    = datos.kmRecorrer || 0;
    if (editingRow) {
      editingRow.cells[0].textContent = cOrigenDestino;
      editingRow.cells[1].textContent = cTipo;
      editingRow.cells[2].textContent = cTarifa;
      editingRow.cells[3].textContent = cCred;
      editingRow.cells[4].textContent = cKm;
      editingRow.dataset.info = JSON.stringify(datos);
    } else {
      const tr = document.createElement('tr');
      tr.dataset.info = JSON.stringify(datos);
      tr.innerHTML = `
        <td>${cOrigenDestino}</td>
        <td>${cTipo}</td>
        <td>${cTarifa}</td>
        <td>${cCred}</td>
        <td>${cKm}</td>
        <td><span class="icon-btn edit-tarifa" title="Editar">‚úèÔ∏è</span></td>
      `;
      tablaTarifas.appendChild(tr);
    }
    ocultarModal();
    limpiarFormulario();
    activarTabTarifas();
    editingRow = null;
    tituloModal.textContent = 'Agregar Nueva Ruta/Tarifa';
  }
  const agregarBtn = document.querySelector('.add-route');
  if (agregarBtn) agregarBtn.addEventListener('click', mostrarModal);
  if (agregarBtn) agregarBtn.addEventListener('click', () => {
    editingRow = null;
    tituloModal.textContent = 'Agregar Nueva Ruta/Tarifa';
    limpiarFormulario();
  });
  document.querySelector('#tarifaModal .close').addEventListener('click', () => { ocultarModal(); activarTabTarifas(); });
  document.querySelector('#tarifaModal .btn-cancelar').addEventListener('click', () => { ocultarModal(); activarTabTarifas(); });
  document.querySelector('#tarifaModal .btn-guardar').addEventListener('click', guardarTarifa);
  window.addEventListener('click', (e) => { if (e.target === modal) ocultarModal(); });
  tablaTarifas.addEventListener('click', (e) => {
    const btn = e.target.closest('.edit-tarifa');
    if (!btn) return;
    const row = btn.closest('tr');
    try {
      const datos = JSON.parse(row.dataset.info || '{}');
      cargarFormulario(datos);
      editingRow = row;
      tituloModal.textContent = 'Editar Ruta/Tarifa';
      mostrarModal();
    } catch {
      alert('No fue posible cargar los datos de la fila para edici√≥n.');
    }
  });

  // === Mostrar detalle cliente
  function mostrarDetalleCliente(id){
    const cliente = getClientes().find(c => c.id === id);
    if(!cliente) return;
    const cont = document.getElementById('detalleClienteContenido');
    const docList = (cliente.docs || []).map(d => `<li>${d.nombre}: ${d.estatus ? 'S√≠' : 'No'}</li>`).join('');
    const tarifasTabla = (cliente.tarifas && cliente.tarifas.length)
      ? `<table class="doc-table"><thead><tr><th>Origen - Destino</th><th>Tipo de Unidad</th><th>Tarifa</th><th>D√≠as de Cr√©dito</th><th>Km</th></tr></thead><tbody>${cliente.tarifas.map(t => `<tr><td>${t.estadoOrigen} - ${t.estadoDestino}</td><td>${t.tipoUnidad}</td><td>${Number(t.tarifa).toLocaleString('es-MX',{style:'currency',currency:'MXN'})}</td><td>${t.diasCredito}</td><td>${t.kmRecorrer}</td></tr>`).join('')}</tbody></table>`
      : '<p>Sin tarifas registradas</p>';
    cont.innerHTML = `
      <h3 class="section-title">Datos Generales</h3>
      <p><strong>Nombre/Raz√≥n Social:</strong> ${cliente.nombre || ''}</p>
      <p><strong>RFC:</strong> ${cliente.rfc || ''}</p>
      <p><strong>Estatus:</strong> ${cliente.estatus || ''}</p>
      <p><strong>Domicilio:</strong> ${cliente.domicilio || ''}</p>
      <h3 class="section-title">Tarifas</h3>
      ${tarifasTabla}
      <h3 class="section-title">Documentaci√≥n</h3>
      <ul>${docList}</ul>
      <h3 class="section-title">Comentarios</h3>
      <p>${cliente.comentario || ''}</p>
    `;
    const modal = document.getElementById('detalleClienteModal');
    modal.classList.remove('hidden');
    modal.style.display = 'flex';
  }
  const detalleModal = document.getElementById('detalleClienteModal');
  detalleModal.querySelector('.close').addEventListener('click', () => {
    detalleModal.classList.add('hidden');
    detalleModal.style.display = 'none';
  });
  window.addEventListener('click', (e) => {
    if (e.target === detalleModal) {
      detalleModal.classList.add('hidden');
      detalleModal.style.display = 'none';
    }
  });
});
</script>


 <script>
//Aqui empieza el modulo de permisionarios
window.addEventListener('DOMContentLoaded', () => {
  // === Claves y referencias
  const srPermKey = 'sr_permisionarios';
  const permsList = document.getElementById('permsList');
  const permsMenu = document.getElementById('permsMenu');
  let editingPermId = null;
  const permInfoModal = document.getElementById('permInfoModal');
  

  // === BD local de permisionarios
  function getPerms(){ try { return JSON.parse(localStorage.getItem(srPermKey)) || []; } catch { return []; } }
  // MIGRACI√ìN AUTOM√ÅTICA DE LA ESTRUCTURA DE PERMISIONARIOS
function migratePermsStorage() {
  const perms = getPerms();
  let changed = false;
  perms.forEach(p => {
    if (!p.documentos) { p.documentos = [
      { nombre: "Acta Constitutiva", estatus: false, archivo: null },
      { nombre: "Poder Rep. Legal", estatus: false, archivo: null },
      { nombre: "Comprobante de Domicilio", estatus: false, archivo: null },
      { nombre: "Constancia de Situaci√≥n Fiscal", estatus: false, archivo: null },
      { nombre: "INE Rep. Legal", estatus: false, archivo: null },
      { nombre: "Contrato", estatus: false, archivo: null }
    ]; changed = true; }
    if (!p.unidades) { p.unidades = []; changed = true; }
    if (!p.operadores) { p.operadores = []; changed = true; }
  });
  if (changed) setPerms(perms);
}
window.addEventListener('DOMContentLoaded', migratePermsStorage);
    
  function setPerms(arr){ localStorage.setItem(srPermKey, JSON.stringify(arr)); }

  function openPermDetalle(id){
  const perm = getPerms().find(p => p.id === id);
  if(!perm || !permInfoModal) return;
  let html = `
    <div class="modal-section">
      <h3>Datos generales</h3>
      <div class="modal-fields">
        <p><label>ID:</label><span>${perm.id || ''}</span></p>
        <p><label>Nombre:</label><span>${perm.nombre || ''}</span></p>
        <p><label>RFC:</label><span>${perm.rfc || ''}</span></p>
        <p><label>Estatus:</label><span>${perm.estatus || ''}</span></p>
        <p><label>Domicilio:</label><span>${perm.contacto || ''}</span></p>
      </div>
    </div>
    <div class="modal-section">
      <h3>Documentos</h3>
      <table class="modal-table"><thead>
        <tr><th>Documento</th><th>Estatus</th><th>Ver</th></tr>
      </thead><tbody>
        ${perm.documentos?.map((d,i) => `
          <tr>
            <td>${d.nombre}</td>
            <td>${d.estatus ? '‚úÖ S√≠' : '‚ùå No'}</td>
            <td>${d.archivo ? `<span class="icon-btn" onclick="window.open('${d.archivo}','_blank')">üîç</span>` : '-'}</td>
          </tr>`).join('')}
      </tbody></table>
    </div>
    <div class="modal-section">
      <h3>Unidades</h3>
      <table class="modal-table"><thead>
        <tr>
          <th>Tarjeta de Circulaci√≥n</th><th>Placas</th><th>Eco</th><th>Tipo</th>
          <th>Vencimiento Poliza</th><th>Aseguradora</th><th>Marca</th><th>A√±o</th><th>Permiso SCT</th>
        </tr>
      </thead><tbody>
        ${(perm.unidades||[]).map(u => `
          <tr>
            <td>${u.tarjeta||''}</td>
            <td>${u.placas||''}</td>
            <td>${u.eco||''}</td>
            <td>${u.tipo||''}</td>
            <td>${u.vencePoliza ? new Date(u.vencePoliza).toLocaleDateString('es-MX') : ''}</td>
            <td>${u.aseguradora||''}</td>
            <td>${u.marca||''}</td>
            <td>${u.anio||''}</td>
            <td>${u.permiso||''}</td>
          </tr>`).join('')}
        ${(!perm.unidades || !perm.unidades.length)?'<tr><td colspan="9">Sin unidades registradas</td></tr>':''}
      </tbody></table>
    </div>
    <div class="modal-section">
      <h3>Operadores</h3>
      <table class="modal-table"><thead>
        <tr>
          <th>Nombre</th><th>N√∫mero de Licencia</th><th>Licencia</th>
          <th>Vto de Licencia</th><th>Apto M√©dico</th><th>Vto de apto.</th><th>RFC</th>
        </tr>
      </thead><tbody>
        ${(perm.operadores||[]).map(o => `
          <tr>
            <td>${o.nombre||''}</td>
            <td>${o.numero||''}</td>
            <td>${o.licencia||''}</td>
            <td>${o.vtoLic||''}</td>
            <td>${o.apto||''}</td>
            <td>${o.vtoApto||''}</td>
            <td>${o.rfc||''}</td>
          </tr>`).join('')}
        ${(!perm.operadores || !perm.operadores.length)?'<tr><td colspan="7">Sin operadores registrados</td></tr>':''}
      </tbody></table>
    </div>
  `;
  permInfoModal.querySelector('.modal-card').innerHTML = `
    <span id="permInfoCerrar" class="close">&times;</span>
    <h2>Detalle del permisionario</h2>
    ${html}
  `;
  permInfoModal.classList.remove('hidden');
  permInfoModal.style.display = 'flex';
  permInfoModal.querySelector('#permInfoCerrar').onclick = closePermDetalle;
}

  function closePermDetalle(){
    if(!permInfoModal) return;
    permInfoModal.classList.add('hidden');
    permInfoModal.style.display = 'none';
  }

      
  // === Render tabla de permisionarios
  function renderTablaPerms(filtro=''){
    const tbody = document.querySelector('#tablaPerms tbody');
    if(!tbody) return;
    const data = getPerms();
    const q = (filtro||'').toLowerCase();
    const fil = data.filter(p =>
      (!q) ||
      (String(p.id||'').toLowerCase().includes(q) ||
       (p.nombre||'').toLowerCase().includes(q) ||
       (p.rfc||'').toLowerCase().includes(q))
    );
    tbody.innerHTML = fil.map(p => `
      <tr>
        <td><button class="perm-id-link" data-id="${p.id}">${p.id || ''}</button>
        <td>${p.nombre || ''}</td>
        <td>${p.estatus || 'Activo'}</td>
        <td class="actions">
          <span class="icon-btn btnPermEdit" title="Editar" data-id="${p.id}">‚úèÔ∏è</span>
          <span class="icon-btn btnPermDelete btnDelete" title="Eliminar" data-id="${p.id}">üóëÔ∏è</span>
        </td>
      </tr>
    `).join('') || `<tr><td colspan="4">Sin registros</td></tr>`;
    tbody.querySelectorAll('.btnPermDelete').forEach(btn => {
      btn.addEventListener('click', () => openDeletePerm(btn.dataset.id));
    });
    tbody.querySelectorAll('.btnPermEdit').forEach(btn => {
      btn.addEventListener('click', () => editPerm(btn.dataset.id));
    });
          tbody.querySelectorAll('.perm-id-link').forEach(btn => {
      btn.addEventListener('click', () => openPermDetalle(btn.dataset.id));
    });
  }

  // === Eliminar permisionario
  const confirmDeleteModal = document.getElementById('confirmDeleteModal');
  const deleteConfirmYes = document.getElementById('deleteConfirmYes');
  const deleteConfirmNo  = document.getElementById('deleteConfirmNo');
  let deletePermId = null;
  function openDeletePerm(id){
    deletePermId = id;
    confirmDeleteModal.classList.remove('hidden');
    confirmDeleteModal.style.display = 'flex';
  }
  function closeDeletePermModal(){
    confirmDeleteModal.classList.add('hidden');
    confirmDeleteModal.style.display = 'none';
    deletePermId = null;
  }
  deleteConfirmYes?.addEventListener('click', () => {
    if(deletePermId){
      const arr = getPerms();
      const idx = arr.findIndex(p => p.id === deletePermId);
      if(idx >= 0){
        arr.splice(idx,1);
        setPerms(arr);
        renderTablaPerms();
      }
    }
    closeDeletePermModal();
  });
  deleteConfirmNo?.addEventListener('click', closeDeletePermModal);
  confirmDeleteModal?.querySelector('.close')?.addEventListener('click', closeDeletePermModal);
  window.addEventListener('click', e => { if(e.target === confirmDeleteModal) closeDeletePermModal(); });

  // === Editar permisionario (flujo b√°sico)
  function editPerm(id){
    const perm = getPerms().find(p => p.id === id);
    if(!perm) return;
    editingPermId = id;
    permsMenu.querySelector('h3').textContent = 'Editar Permisionario';
    permsMenu.classList.remove('hidden');
    permsList.classList.add('hidden');
    document.querySelector('#permsMenu .subtab[data-target="perm-datos"]')?.click();
    document.getElementById('permNombre').value = perm.nombre || '';
    document.getElementById('permRFC').value = perm.rfc || '';
    document.getElementById('permEstatus').value = perm.estatus || 'Activo';
    document.getElementById('permContacto').value = perm.contacto || '';
  }

  // === Limpiar formulario nuevo permisionario
  function limpiarFormularioPerm(){
    permsMenu.querySelectorAll('input, textarea').forEach(el => { el.value = ''; });
    permsMenu.querySelectorAll('select').forEach(sel => sel.selectedIndex = 0);
  }

  // === Bot√≥n "Nuevo Permisionario"
  document.getElementById('btnPermNuevo')?.addEventListener('click', () => {
    editingPermId = null;
    limpiarFormularioPerm();
    permsMenu.querySelector('h3').textContent = 'Nuevo Permisionario';
    permsMenu.classList.remove('hidden');
    permsList.classList.add('hidden');
    document.querySelector('#permsMenu .subtab[data-target="perm-datos"]')?.click();
  });

  // === Volver al dashboard desde permisionarios
  document.getElementById('btnPermVolver')?.addEventListener('click', () => {
    showSection('dashboard');
  });

  // === Cancelar (volver a la lista)
  document.getElementById('btnPermCancelar')?.addEventListener('click', () => {
    permsMenu.classList.add('hidden');
    permsList.classList.remove('hidden');
  });

  // === Guardar permisionario
  document.getElementById('btnPermGuardar')?.addEventListener('click', () => {
    const nombre   = document.getElementById('permNombre').value.trim();
    const rfc      = document.getElementById('permRFC').value.trim();
    const estatus  = document.getElementById('permEstatus').value;
    const contacto = document.getElementById('permContacto').value.trim();

    if(!nombre || !rfc){
      alert('Por favor, completa al menos Nombre/Raz√≥n social y RFC.');
      return;
    }

    const arr = getPerms();
    let id = editingPermId;

    if(editingPermId){
      const idx = arr.findIndex(p => p.id === editingPermId);
      if(idx >= 0) arr[idx] = { id: editingPermId, nombre, rfc, estatus, contacto };
    } else {
      id = generarSiguienteIdPerm(arr);
      arr.push({ id, nombre, rfc, estatus, contacto });
    }
    setPerms(arr);

    permsMenu.classList.add('hidden');
    permsList.classList.remove('hidden');
    renderTablaPerms();
    editingPermId = null;
  });

  // === Generar siguiente ID consecutivo tipo LTR-PR-01
  function generarSiguienteIdPerm(arr){
    const prefijo = 'LTR-PR-';
    const maxNum = arr.reduce((max, p) => {
      const m = (p.id || '').match(/^LTR-PR-(\d+)$/);
      const n = m ? parseInt(m[1], 10) : 0;
      return n > max ? n : max;
    }, 0);
    return `${prefijo}${String(maxNum + 1).padStart(2, '0')}`;
  }

  // === Buscar en la lista
  document.getElementById('searchPerm')?.addEventListener('input', (e) => {
    renderTablaPerms(e.target.value);
  });

  // === Subtabs permisionarios (Datos / Documentos / Unidades / Comentarios)
  document.querySelectorAll('#permsMenu .subtab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('#permsMenu .subtab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      const tgt = tab.dataset.target;
      document.querySelectorAll('#permsMenu .subcontent').forEach(c => c.classList.remove('active'));
      document.getElementById(tgt).classList.add('active');
    });
  });
  document.getElementById('permInfoCerrar')?.addEventListener('click', closePermDetalle);
  permInfoModal?.addEventListener('click', (e) => { if(e.target === permInfoModal) closePermDetalle(); });
  document.addEventListener('keydown', (e) => { if(e.key === 'Escape') closePermDetalle(); });    

  // === Inicializar tabla si est√° vac√≠a (opcional demo)
  if(getPerms().length === 0){
    setPerms([
      { id: 'LTR-PR-01', nombre: 'Permisionario Demo S.A. de C.V.', rfc: 'PDE010101AB1', estatus: 'Activo', contacto: 'Av. Ejemplo 123' }
    ]);
  }
//Pesta√±a de documentaci√≥n 
      document.querySelectorAll('.perm-folder').forEach(btn => {
  btn.onclick = () => {
    const row = btn.dataset.row;
    const inp = document.getElementById('permFile' + row);
    inp.click();
    inp.onchange = () => {
      const st = document.getElementById('permStatus' + row);
      st.textContent = '‚úÖ S√≠';
      st.classList.remove('status-no');
      st.classList.add('status-yes');
    };
  };
});
document.querySelectorAll('.perm-view').forEach(btn => {
  btn.onclick = () => {
    const row = btn.dataset.row;
    const inp = document.getElementById('permFile' + row);
    if (inp.files.length) {
      const url = URL.createObjectURL(inp.files[0]);
      window.open(url);
    } else {
      alert('No hay archivo cargado a√∫n');
    }
  };
});

  // Modal +agegar unidad
  renderTablaPerms();
});
(function(){
  const btnAddUnit = document.querySelector('#permsMenu .add-unit');
  const unidadModal = document.getElementById('unidadModal');
  const tablaUnidadesBody = document.querySelector('#tablaUnidades tbody');
  const $ = (id) => document.getElementById(id);
  const f = {
    tarjeta: $('uTarjeta'),
    placas: $('uPlacas'),
    eco: $('uEco'),
    tipo: $('uTipo'),
    vencePoliza: $('uVencePoliza'),
    aseguradora: $('uAseguradora'),
    marca: $('uMarca'),
    anio: $('uAnio'),
    permiso: $('uPermisoSCT'),
  };

  let unidadEditingRow = null;

  function limpiarFormUnidad(){
    f.tarjeta.value = '';
    f.placas.value = '';
    f.eco.value = '';
    f.tipo.value = '';
    f.vencePoliza.value = '';
    f.aseguradora.value = '';
    f.marca.value = '';
    f.anio.value = '';
    f.permiso.value = '';
  }

  function mostrarUnidadModal(){
    unidadModal.classList.remove('hidden');
    unidadModal.style.display = 'flex';
  }
  function ocultarUnidadModal(){
    unidadModal.classList.add('hidden');
    unidadModal.style.display = 'none';
  }

  btnAddUnit?.addEventListener('click', () => {
    unidadEditingRow = null;
    limpiarFormUnidad();
    unidadModal.querySelector('h3').textContent = 'Alta de Unidad Vehicular';
    mostrarUnidadModal();
  });

  unidadModal.querySelector('.close')?.addEventListener('click', ocultarUnidadModal);
  unidadModal.querySelector('.btn-cancelar')?.addEventListener('click', ocultarUnidadModal);

unidadModal.querySelector('.btn-guardar')?.addEventListener('click', () => {
  const archivoInput = document.getElementById('uTarjetaFile');
  let archivoURL = '';
  if (archivoInput && archivoInput.files.length) {
    archivoURL = URL.createObjectURL(archivoInput.files[0]);
  }

  const datos = {
    tarjeta: archivoURL,
    placas: (f.placas.value || '').trim(),
    eco: (f.eco.value || '').trim(),
    tipo: f.tipo.value,
    vencePoliza: f.vencePoliza.value,
    aseguradora: (f.aseguradora.value || '').trim(),
    marca: (f.marca.value || '').trim(),
    anio: f.anio.value ? Number(f.anio.value) : '',
    permiso: (f.permiso.value || '').trim(),
  };

if(unidadEditingRow) {
    // Si se est√° editando, actualiza la fila
    unidadEditingRow.dataset.info = JSON.stringify(datos);
    unidadEditingRow.cells[0].innerHTML = `<span class="icon-btn unidad-lupa" title="Ver archivo" data-url="${datos.tarjeta}">üîç</span>`;
    unidadEditingRow.cells[1].textContent = datos.placas;
    unidadEditingRow.cells[2].textContent = datos.eco;
    unidadEditingRow.cells[3].textContent = datos.tipo;
    unidadEditingRow.cells[4].textContent = venceLegible;
    unidadEditingRow.cells[5].textContent = datos.aseguradora;
    unidadEditingRow.cells[6].textContent = datos.marca;
    unidadEditingRow.cells[7].textContent = datos.anio || '';
    unidadEditingRow.cells[8].textContent = datos.permiso;
    // No olvides volver a colocar los iconos de editar/eliminar si los reemplazas
    unidadEditingRow.cells[9].innerHTML = `
      <span class="icon-btn unidad-edit" title="Editar">‚úèÔ∏è</span>
      <span class="icon-btn unidad-delete" title="Eliminar">üóëÔ∏è</span>
    `;
    // Re-asignar eventos
    unidadEditingRow.querySelector('.unidad-edit').addEventListener('click', () => {
      // Llama de nuevo la edici√≥n
      const datos = JSON.parse(unidadEditingRow.dataset.info || '{}');
      f.tarjeta.value = datos.tarjeta || '';
      f.placas.value = datos.placas || '';
      f.eco.value = datos.eco || '';
      f.tipo.value = datos.tipo || '';
      f.vencePoliza.value = datos.vencePoliza || '';
      f.aseguradora.value = datos.aseguradora || '';
      f.marca.value = datos.marca || '';
      f.anio.value = datos.anio || '';
      f.permiso.value = datos.permiso || '';
      unidadEditingRow = unidadEditingRow;
      unidadModal.querySelector('h3').textContent = 'Editar Unidad Vehicular';
      mostrarUnidadModal();
    });
    unidadEditingRow.querySelector('.unidad-delete').addEventListener('click', () => {
      if(confirm('¬øDesea eliminar esta unidad?')) {
        unidadEditingRow.remove();
      }
    });
  } else {
    // Si es nueva, crea la fila normalmente
    const tr = document.createElement('tr');
    tr.dataset.info = JSON.stringify(datos);
    tr.innerHTML = `
      <td><span class="icon-btn unidad-lupa" title="Ver archivo" data-url="${datos.tarjeta}">üîç</span></td>
      <td>${datos.placas}</td>
      <td>${datos.eco}</td>
      <td>${datos.tipo}</td>
      <td>${venceLegible}</td>
      <td>${datos.aseguradora}</td>
      <td>${datos.marca}</td>
      <td>${datos.anio || ''}</td>
      <td>${datos.permiso}</td>
      <td class="actions">
        <span class="icon-btn unidad-edit" title="Editar">‚úèÔ∏è</span>
        <span class="icon-btn unidad-delete" title="Eliminar">üóëÔ∏è</span>
      </td>
    `;
    tablaUnidadesBody.appendChild(tr);

    // Asigna eventos igual que arriba
    tr.querySelector('.unidad-edit').addEventListener('click', () => {
      const datos = JSON.parse(tr.dataset.info || '{}');
      f.tarjeta.value = datos.tarjeta || '';
      f.placas.value = datos.placas || '';
      f.eco.value = datos.eco || '';
      f.tipo.value = datos.tipo || '';
      f.vencePoliza.value = datos.vencePoliza || '';
      f.aseguradora.value = datos.aseguradora || '';
      f.marca.value = datos.marca || '';
      f.anio.value = datos.anio || '';
      f.permiso.value = datos.permiso || '';
      unidadEditingRow = tr;
      unidadModal.querySelector('h3').textContent = 'Editar Unidad Vehicular';
      mostrarUnidadModal();
    });
    tr.querySelector('.unidad-delete').addEventListener('click', () => {
      if(confirm('¬øDesea eliminar esta unidad?')) {
        tr.remove();
      }
    });
  }

  ocultarUnidadModal();
  limpiarFormUnidad();
  unidadEditingRow = null;
});
      
  const venceLegible = datos.vencePoliza
    ? new Date(datos.vencePoliza).toLocaleDateString('es-MX')
    : '';

  const tr = document.createElement('tr');
  tr.dataset.info = JSON.stringify(datos);
  tr.innerHTML = `
    <td><span class="icon-btn unidad-lupa" title="Ver archivo" data-url="${datos.tarjeta}">üîç</span></td>
    <td>${datos.placas}</td>
    <td>${datos.eco}</td>
    <td>${datos.tipo}</td>
    <td>${venceLegible}</td>
    <td>${datos.aseguradora}</td>
    <td>${datos.marca}</td>
    <td>${datos.anio || ''}</td>
    <td>${datos.permiso}</td>
    <td class="actions">
    <span class="icon-btn unidad-edit" title="Editar">‚úèÔ∏è</span>
    <span class="icon-btn unidad-delete" title="Eliminar">üóëÔ∏è</span>
  </td>
    
  `;
  tablaUnidadesBody.appendChild(tr);
// Evento para editar
tr.querySelector('.unidad-edit').addEventListener('click', () => {
  // Cargar datos en el modal
  const datos = JSON.parse(tr.dataset.info || '{}');
  f.tarjeta.value = datos.tarjeta || '';
  f.placas.value = datos.placas || '';
  f.eco.value = datos.eco || '';
  f.tipo.value = datos.tipo || '';
  f.vencePoliza.value = datos.vencePoliza || '';
  f.aseguradora.value = datos.aseguradora || '';
  f.marca.value = datos.marca || '';
  f.anio.value = datos.anio || '';
  f.permiso.value = datos.permiso || '';
  
  // Guarda referencia a la fila que se est√° editando
  unidadEditingRow = tr;
  unidadModal.querySelector('h3').textContent = 'Editar Unidad Vehicular';
  mostrarUnidadModal();
});

// Evento para eliminar
tr.querySelector('.unidad-delete').addEventListener('click', () => {
  if(confirm('¬øDesea eliminar esta unidad?')) {
    tr.remove();
  }
});
  ocultarUnidadModal();
  limpiarFormUnidad();
  unidadEditingRow = null;
});
  

  window.addEventListener('click', (e) => {
    if (e.target === unidadModal) ocultarUnidadModal();
  });

 tablaUnidadesBody.addEventListener('click', function(e) {
  const btn = e.target.closest('.unidad-lupa');
  if (!btn) return;
  const url = btn.dataset.url;
  if (url) {
    window.open(url, '_blank');
  } else {
    alert('No hay archivo adjunto');
  }
}); 
  
})();
//Boton de adjuntar tarjeta de circulaci√≥n
window.addEventListener('DOMContentLoaded', () => {
  const btnUTarjetaPick = document.getElementById('btnUTarjetaPick');
  const uTarjetaFile = document.getElementById('uTarjetaFile');
  const uTarjetaName = document.getElementById('uTarjetaName');

  if(btnUTarjetaPick && uTarjetaFile && uTarjetaName) {
    btnUTarjetaPick.addEventListener('click', () => {
      uTarjetaFile.click();
    });

    uTarjetaFile.addEventListener('change', () => {
      if(uTarjetaFile.files.length) {
        uTarjetaName.value = uTarjetaFile.files[0].name;
        uTarjeta.value = uTarjetaFile.files[0].name    
      } else {
        uTarjetaName.value = '';
      }
    });
  }
});
//B√≥ton de adjuntar p√≥liza    
 window.addEventListener('DOMContentLoaded', () => {
  const btnUPolizaPick = document.getElementById('btnUPolizaPick');
  const uPolizaFile = document.getElementById('uPolizaFile');
  const uPolizaName = document.getElementById('uPolizaName');

  if(btnUPolizaPick && uPolizaFile && uPolizaName) {
    btnUPolizaPick.addEventListener('click', () => {
      uPolizaFile.click();
    });

    uPolizaFile.addEventListener('change', () => {
      if(uPolizaFile.files.length) {
        uPolizaName.value = uPolizaFile.files[0].name;
      } else {
        uPolizaName.value = '';
      }
    });
  }
});   

  //Modal de +Agregar Operador
(function(){
  const btnAddOperator = document.querySelector('#permsMenu .add-operator');
  const operadorModal = document.getElementById('operadorModal');
  const tablaOperadoresBody = document.querySelector('#tablaOperadores tbody');

  const $ = (id) => document.getElementById(id);
  const f = {
    nombre: $('opNombre'),
    numero: $('opNumeroLicencia'),
    licencia: $('opLicencia'),
    vtoLic: $('opVtoLicencia'),
    apto: $('opAptoMedico'),
    vtoApto: $('opVtoApto'),
    rfc: $('opRFC'),
  };

  function limpiar(){
    Object.values(f).forEach(el => { if (el) el.value = ''; });
  }

  function mostrar(){
    operadorModal.classList.remove('hidden');
    operadorModal.style.display = 'flex';
  }
  function ocultar(){
    operadorModal.classList.add('hidden');
    operadorModal.style.display = 'none';
  }

  btnAddOperator?.addEventListener('click', () => {
    limpiar();
    mostrar();
  });

  operadorModal.querySelector('.close')?.addEventListener('click', ocultar);
  operadorModal.querySelector('.btn-cancelar')?.addEventListener('click', ocultar);

  operadorModal.querySelector('.btn-guardar')?.addEventListener('click', () => {
    const datos = {
      nombre: f.nombre.value.trim(),
      numero: f.numero.value.trim(),
      licencia: f.licencia.value.trim(),
      vtoLic: f.vtoLic.value,
      apto: f.apto.value.trim(),
      vtoApto: f.vtoApto.value,
      rfc: f.rfc.value.trim(),
    };

    if(!datos.tarjeta || !datos.placas || !datos.tipo){
  alert('Completa los campos obligatorios: Tarjeta, Placas y Tipo.');
  return;
    }

    const vtoLicLegible = datos.vtoLic ? new Date(datos.vtoLic + 'T00:00:00').toLocaleDateString('es-MX') : '';
    const vtoAptoLegible = datos.vtoApto ? new Date(datos.vtoApto + 'T00:00:00').toLocaleDateString('es-MX') : '';

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${datos.nombre}</td>
      <td>${datos.numero}</td>
      <td>${datos.licencia}</td>
      <td>${vtoLicLegible}</td>
      <td>${datos.apto}</td>
      <td>${vtoAptoLegible}</td>
      <td>${datos.rfc}</td>
    `;
    tablaOperadoresBody.appendChild(tr);

    ocultar();
    limpiar();
  });

  window.addEventListener('click', (e) => { if (e.target === operadorModal) ocultar(); });

})(); 
window.addEventListener('DOMContentLoaded', () => {
  //aqui esta para guardar lainformacio√≥n                  
  const btnGuardar =
  document.getElementById('btnPermGuardar')?.addEventListener('click', () => {
  const nombre   = document.getElementById('permNombre').value.trim();
  const rfc      = document.getElementById('permRFC').value.trim();
  const estatus  = document.getElementById('permEstatus').value;
  const contacto = document.getElementById('permContacto').value.trim();

  // Documentos
  const docNames = [
    "Acta Constitutiva", "Poder Rep. Legal", "Comprobante de Domicilio",
    "Constancia de Situaci√≥n Fiscal", "INE Rep. Legal", "Contrato"
  ];
  const documentos = docNames.map((nombre, idx) => {
    const st = document.getElementById(`permStatus${idx+1}`);
    const inp = document.getElementById(`permFile${idx+1}`);
    let archivo = null;
    if (inp && inp.files && inp.files.length) {
      // Guardar archivo como URL temporal (solo para ver)
      archivo = URL.createObjectURL(inp.files[0]);
    }
    return {
      nombre,
      estatus: st?.classList.contains('status-yes') || false,
      archivo
    };
  });

  // Unidades
  const unidadesBody = document.querySelector('#tablaUnidades tbody');
  const unidades = Array.from(unidadesBody?.children || []).map(tr => {
    try { return JSON.parse(tr.dataset.info || '{}'); } catch { return {}; }
  });

  // Operadores
  const operadoresBody = document.querySelector('#tablaOperadores tbody');
  const operadores = Array.from(operadoresBody?.children || []).map(tr => {
    const tds = tr.querySelectorAll('td');
    return {
      nombre: tds[0]?.textContent || '',
      numero: tds[1]?.textContent || '',
      licencia: tds[2]?.textContent || '',
      vtoLic: tds[3]?.textContent || '',
      apto: tds[4]?.textContent || '',
      vtoApto: tds[5]?.textContent || '',
      rfc: tds[6]?.textContent || ''
    };
  });

  if(!nombre || !rfc){
    alert('Por favor, completa al menos Nombre/Raz√≥n social y RFC.');
    return;
  }

  const arr = getPerms();
  let id = editingPermId;

  if(editingPermId){
    const idx = arr.findIndex(p => p.id === editingPermId);
    if(idx >= 0) arr[idx] = { id: editingPermId, nombre, rfc, estatus, contacto, documentos, unidades, operadores };
  } else {
    id = generarSiguienteIdPerm(arr);
    arr.push({ id, nombre, rfc, estatus, contacto, documentos, unidades, operadores });
  }
  setPerms(arr);

  permsMenu.classList.add('hidden');
  permsList.classList.remove('hidden');
  renderTablaPerms();
  editingPermId = null;
});
  const modal = document.getElementById('permSaveModal');
  const btnCerrar = document.getElementById('permModalCerrar');
  const resumen = document.getElementById('permResumenGuardado');
  const idLabel = document.getElementById('permIDMostrado');

  function nextPermId(){
    const n = parseInt(localStorage.getItem('permCounter') || '0', 10) + 1;
    localStorage.setItem('permCounter', String(n));
    return 'LTR-PR-' + String(n).padStart(2,'0');
  }

  function buildPermResumen(){
    const nombre = document.getElementById('permNombre')?.value?.trim() || '';
    const rfc = document.getElementById('permRFC')?.value?.trim() || '';
    const domicilio = document.getElementById('permContacto')?.value?.trim() || '';
    if(resumen){
      resumen.innerHTML = `
        <div style="display:grid;gap:6px;">
          <div><strong>Permisionario:</strong> ${nombre || '-'}</div>
          <div><strong>RFC:</strong> ${rfc || '-'}</div>
          <div><strong>Domicilio:</strong> ${domicilio || '-'}</div>
        </div>`;
    }
  }
  tr.querySelector('.unidad-edit').addEventListener('click', () => {
  // Aqu√≠ puedes cargar los datos en el modal para editar la unidad
  cargarUnidadParaEditar(tr);
});
tr.querySelector('.unidad-delete').addEventListener('click', () => {
  tr.remove();
});    

  // Mostramos el modal al guardar
  if(btnGuardar && modal){
    btnGuardar.addEventListener('click', (ev) => {
      if (typeof ev.preventDefault === 'function') ev.preventDefault();
      if (btnGuardar.disabled) return;
      const genId = nextPermId();
      if(idLabel) idLabel.textContent = genId;
      buildPermResumen();
      modal.classList.remove('hidden');
      modal.style.display = 'flex';
    });
  }

  btnCerrar?.addEventListener('click', () => {
    modal.classList.add('hidden');
    modal.style.display = 'none';
  });
  modal?.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.classList.add('hidden');
      modal.style.display = 'none';
    }
  });
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      modal.classList.add('hidden');
      modal.style.display = 'none';
    }
  });
});       
</script>     

<!-- Detalle permisionario -->
<div id="permInfoModal" class="modal-overlay hidden" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);z-index:1000;">
  <div class="modal-card">
    <span id="permInfoCerrar" class="close">&times;</span>
    <h2>Detalle del permisionario</h2>
    <div class="modal-section">
      <h3>Datos generales</h3>
      <div class="modal-fields">
        <p><label>ID:</label><span id="permInfoId"></span></p>
        <p><label>Nombre:</label><span id="permInfoNombre"></span></p>
        <p><label>RFC:</label><span id="permInfoRFC"></span></p>
        <p><label>Estatus:</label><span id="permInfoEstatus"></span></p>
        <p><label>Domicilio:</label><span id="permInfoContacto"></span></p>
      </div>
    </div>
  </div>
</div>
      
<!-- Guardar permisionario -->     
 <div id="permSaveModal" class="modal-overlay hidden" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);z-index:1000;">
  <div class="modal-card" style="width:min(520px,92vw);background:#1e1e1e;color:#fff;border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.5);overflow:hidden;">
    <div style="padding:20px 24px;border-bottom:1px solid rgba(255,255,255,.08);display:flex;align-items:center;gap:12px;">
      <div style="font-size:28px;">üéâ</div>
      <h3 style="margin:0;font-size:20px;font-weight:700;">¬°Felicidades, agregaste un nuevo permisionario!</h3>
    </div>
    <div style="padding:20px 24px;">
      <p style="margin:0 0 12px 0;opacity:.9;">El registro se ha creado correctamente.</p>
      <div style="margin-bottom:10px;">
        <div id="permIDMostrado" style="color:#ff6b6b;font-weight:800;font-size:16px"></div>
      </div>
      <div id="permResumenGuardado" style="font-size:14px;opacity:.9;"></div>
    </div>
    <div style="padding:16px 24px;display:flex;gap:12px;justify-content:flex-end;background:rgba(255,255,255,.03);">
      <button id="permModalCerrar" class="btn btn-primary" style="padding:10px 16px;border-radius:10px;border:none;cursor:pointer;">Aceptar</button>
    </div>
  </div>
</div>

  
</body>
</html>
