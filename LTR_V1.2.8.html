<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>SistemaRoque V1.1.70</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    :root {
      --bg: #f5f5f5;
      --panel-bg: #fff;
      --frame-border: #000;
      --text: #222;
      --font: "Segoe UI", Tahoma, sans-serif;
      --input-border: #00b8f4;
      --section-bg: #e8e8e8;
      --tab-bg: #ddd;
      --tab-active: #fff;
      --tab-border: #000;
    }
    * { box-sizing: border-box; margin:0; padding:0; }
    body { background: var(--bg); font-family: var(--font); color: var(--text); }
    .hidden { display: none; }
    .frame {
      position: relative;
      margin: 50px auto; padding: 40px 20px 20px; max-width: 920px;
      background: var(--panel-bg);
      border: 4px solid var(--frame-border);
      border-radius: 12px;
    }
    /* Login */
    #loginFrame { text-align:center; }
    #loginFrame input {
      width: calc(100% - 16px); padding: 8px; margin: 6px 0;
      border: 2px solid #ccc; border-radius: 6px;
      font-size: .9rem;
    }
    #loginFrame button {
      padding: 8px 16px; margin: 8px 4px;
      border:2px solid var(--frame-border); background:#e5e5e5; cursor:pointer; font-weight:700; border-radius:8px;
    }
    /* Dashboard */
    #dashboard h2 { text-align:center; margin-bottom:16px; }
    .dashboard { display:grid; grid-template-columns:repeat(5,1fr); gap:20px; justify-items:center; }
    .module { width:100px; height:100px; background:var(--panel-bg);
      border:2px solid var(--frame-border); border-radius:8px;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      cursor:pointer; transition:transform .1s;
    }
    .module:hover { transform:translateY(-3px); }
    .module-icon { font-size:2rem; }
    .module-label { margin-top:8px; font-weight:bold; font-size:.9rem; text-align:center; }
    /* clientsModule */
    .clients-menu {
      margin: 0 auto; width: 100%; max-width:860px; background:var(--section-bg);
      border-radius:12px; padding:20px;
    }
    /* Sub-tabs */
    .sub-tabs { display:flex; border-bottom:2px solid var(--tab-border); margin-bottom:16px; }
    .sub-tab {
      padding:8px 16px; cursor:pointer;
      background: var(--tab-bg); border:2px solid var(--tab-border); border-bottom:none;
      margin-right:4px; border-radius:8px 8px 0 0;
    }

    .btn {
  padding: 8px 16px;
  margin: 8px 4px;
  border: 2px solid #000;    /* Puedes usar var(--frame-border) si tienes variables CSS */
  background: #e5e5e5;
  cursor: pointer;
  font-weight: 700;
  border-radius: 8px;
    }
  
    .sub-tab.active { background: var(--tab-active); }
    .sub-content { display:none; }
    .sub-content.active { display:block; }
    .form-group { display:grid; grid-template-columns:220px 1fr; align-items:center; gap:12px; margin:8px 0; }
    h3.section-title { margin-top:16px; font-size:1.1rem; border-bottom:1px solid #000; padding-bottom:4px; }
    .button-row { display:flex; justify-content:center; gap:12px; margin-top:16px; }
    /* Documentation table */
    .doc-table-wrapper { border:2px dashed var(--input-border); padding:12px; }
    table.doc-table { width:100%; border-collapse: collapse; }
    table.doc-table th, table.doc-table td { border:1px solid var(--input-border); padding:8px; text-align:center; }
    table.doc-table th { background:#eee; }
    .icon-btn { cursor:pointer; margin: 0 4px; font-size:1.2rem; }
    .btnDelete { color: #d00; }
    .status-no { color: red; font-weight:bold; }
    .status-yes { color: green; font-weight:bold; }
    input[type="file"] { display: none; }
    /* Modal */
    .modal {
      position: fixed;
      z-index: 1000;
      inset: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }
    .modal-content {
      background-color: var(--panel-bg);
      padding: 20px;
      border: 2px solid var(--frame-border);
      border-radius: 8px;
      width: max-content;
      max-width: 96vw;
      max-height: 90vh;
      overflow: auto;
      position: relative;
    }
    .close {
      position: absolute;
      right: 10px;
      top: 5px;
      font-size: 1.5rem;
      cursor: pointer;
    }
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 12px;
    }
    .form-group-full {
      grid-column: span 2;
    }
    .form-group label {
      display: block;
      margin-bottom: 4px;
      font-weight: bold;
    }
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 8px;
      border: 2px solid #ccc;
      border-radius: 6px;
    }
    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }
     /* --- Selector inicial de Clientes --- */
.clients-home{
  margin:0 auto 12px; width:100%; max-width:860px;
  background:#e9e9ec; border-radius:12px; padding:28px 24px;
  outline:3px solid #7c3aed; /* morado */
}
.home-grid{display:grid; grid-template-columns:1fr 1fr; gap:24px; align-items:center; justify-items:center;}
.choice-card{
  width:100%; min-height:220px; background:#efefef; border:2px solid #000; border-radius:12px;
  display:flex; flex-direction:column; align-items:center; justify-content:center; gap:18px;
  cursor:pointer; transition:transform .12s ease, box-shadow .12s ease; user-select:none;
}
.choice-card:hover{ transform:translateY(-2px); box-shadow:0 6px 18px rgba(0,0,0,.15);}
.choice-card svg{ width:96px; height:96px;}
.choice-label{ font-weight:700; letter-spacing:.03em;}
@media (max-width:780px){ .home-grid{grid-template-columns:1fr;} }

  /* --- Lista de clientes (nueva ventana) --- */
.clients-list .list-toolbar{
  display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin-bottom:12px;
}
.clients-list .list-actions{ display:flex; gap:8px; }
.clients-list .search{ display:flex; gap:8px; align-items:center; }
.clients-list .search input{
  padding:8px; border:2px solid var(--input-border); border-radius:8px; min-width:220px;
}
.btn { padding:8px 16px; border:2px solid var(--frame-border); background:#e5e5e5; border-radius:8px; cursor:pointer; }
btn.primary { background:#efe9ff; border-color:#7c3aed; }

.client-id-link { color:#000; text-decoration:underline; cursor:pointer; }


 /* --- te ayuda a que no se baje nada de esa celda --- */
    .doc-table td.actions { white-space: nowrap; }

    .confirm-cliente {
  background-color: #666; /* gris oscuro */
  color: #fff;
  text-align: center;
}

.confirm-cliente h3 {
  margin-bottom: 8px;
}

.confirm-cliente .id-cliente {
  color: red;
  font-weight: bold;
  margin-bottom: 12px;
  font-size: 1.1rem;
}

.confirm-cliente .datos-cliente {
  text-align: left;
  background-color: rgba(255,255,255,0.1);
  padding: 10px;
  border-radius: 6px;
}

.confirm-cliente .datos-cliente p {
  margin: 4px 0;
}
    
  display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin-bottom:12px;
}
.perms-list .list-actions{ display:flex; gap:8px; }
.perms-list .search{ display:flex; gap:8px; align-items:center; }
.perms-list .search input{
  padding:8px; border:2px solid var(--input-border); border-radius:8px; min-width:220px;
}
  /* --- Bot√≥n + Nuevo Permisionario --- */
.btn.primary { background:#efe9ff; border-color:#7c3aed; }


/* --- Sub-tabs Permisionarios --- */
.subtabs { display:flex; gap:8px; margin: 12px 0; border-bottom: 2px solid var(--input-border); }
.subtabs .subtab {
  padding: 8px 12px; cursor:pointer; border-radius: 8px 8px 0 0;
}
.subtabs .subtab.active {
  background: var(--chip-bg, #f0f3f7);
  font-weight: 600;
}
.subcontent { display:none; }
.subcontent.active { display:block; }

.form-row { display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:12px; }
.form-row .fld { display:flex; flex-direction:column; gap:6px; }
.form-row input, .form-row select, .form-row textarea {
  padding: 8px; border: 2px solid var(--input-border); border-radius: 8px;
}
.actions-bar { display:flex; gap:8px; justify-content:flex-end; margin-top: 12px; 
}
    
    
  </style>
</head>
<body>

  <!-- Modales (movidos dentro de <body>) -->
<!-- Modal de confirmaci√≥n de cliente -->
<div id="clienteModal" class="modal hidden">
  <div class="modal-content" style="text-align:center; padding: 40px;">
    <span class="close" title="Cerrar">&times;</span>
    <h2>¬°Felicidades, agregaste un nuevo cliente!</h2>
    <div class="id-cliente">ID CLIENTE: <span id="idClienteTexto">LTR-CL-01</span></div>
    <div class="datos-cliente">
      <p><strong>Cliente:</strong> <span id="nombreCliente"></span></p>
      <p><strong>RFC:</strong> <span id="rfcCliente"></span></p>
      <p><strong>Domicilio:</strong> <span id="domicilioCliente"></span></p>
    </div>
    <div class="modal-buttons">
      <button type="button" class="btn-cerrar">Cerrar</button>
  </div>
  </div>
  <!-- Modal de confirmaci√≥n de eliminaci√≥n -->
</div>

<div id="confirmDeleteModal" class="modal hidden">
  <div class="modal-content" style="text-align:center; padding: 40px;">
    <span class="close" title="Cerrar">&times;</span>
    <p>¬øDesea eliminar este cliente?</p>
    <div class="modal-buttons" style="justify-content:center;">
      <button id="deleteConfirmYes" class="btn primary">S√≠</button>
      <button id="deleteConfirmNo" class="btn">No</button>
    </div>
  </div>
</div>
<!-- Modal para ver detalles del cliente -->
<div id="detalleClienteModal" class="modal hidden">
  <div class="modal-content">
    <span class="close" title="Cerrar">&times;</span>
    <div id="detalleClienteContenido"></div>
  </div>
</div>

    
    

    <!-- Aqui acaba el .css y empieza el html la segunda parte para que sea mas facil ubicarlo -->


    
    
  <!-- LOGIN -->
  <div id="loginFrame" class="frame">
    <input type="text" id="usuario" placeholder="David Vargas R.">
    <input type="password" id="password" placeholder="1234">
    <div>
      <button id="btnGuardar">Guardar</button>
      <button id="btnEntrar">Entrar</button>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" class="frame hidden">
    <h2>Men√∫ Principal</h2>
    <div class="dashboard">
      <div class="module" id="modClientes"><div class="module-icon">üìã</div><div class="module-label">Clientes</div></div>
      <div class="module" id="modPerm"><div class="module-icon">üöö</div><div class="module-label">Permisionarios</div></div>
      <div class="module" id="modAsign"><div class="module-icon">üìÖ</div><div class="module-label">Asignaci√≥n</div></div>
      <div class="module" id="modMonit"><div class="module-icon">üì°</div><div class="module-label">Monitoreo</div></div>
      <div class="module" id="modCoord"><div class="module-icon">üîß</div><div class="module-label">Coordinaci√≥n</div></div>
      <div class="module" id="modCCP"><div class="module-icon">üí∞</div><div class="module-label">Ctas Cob/PP</div></div>
      <div class="module" id="modLiq"><div class="module-icon">üìä</div><div class="module-label">Liquidaci√≥n</div></div>
      <div class="module" id="modMant"><div class="module-icon">üõ†Ô∏è</div><div class="module-label">Mantenimiento</div></div>
      <div class="module" id="modAdmin"><div class="module-icon">üóÑÔ∏è</div><div class="module-label">Administraci√≥n</div></div>
      <div class="module" id="modDocs"><div class="module-icon">üìÑ</div><div class="module-label">Documentaci√≥n</div></div>
    </div>
  </div>

  <!-- clientsModule -->
  <div id="clientsModule" class="frame hidden">
    <!-- Selector inicial -->
<div id="clientsHome" class="clients-home">
  <div class="home-grid">
    <!-- Nuevo Cliente -->
    <div id="btnNuevoCliente" class="choice-card" role="button" tabindex="0" aria-label="Nuevo cliente">
      <!-- icono apret√≥n de manos -->
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M12 12l3 3a2 2 0 1 1-3 3l-2-2-1 1a2 2 0 1 1-3-3l1-1-1-1a2 2 0 0 1 3-3l1 1 1-1a2 2 0 1 1 3 3l-2 2z"/>
        <path d="M18 8l3-3M6 8 3 5"/>
      </svg>
      <div class="choice-label">NUEVO CLIENTE</div>
    </div>

    <!-- Clientes -->
    <div id="btnVerClientes" class="choice-card" role="button" tabindex="0" aria-label="Clientes">
      <!-- icono grupo de personas -->
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
        <circle cx="9" cy="7" r="3"/>
        <path d="M22 21v-2a4 4 0 0 0-3-3.87M16 3.13a3 3 0 0 1 0 5.75"/>
      </svg>
      <div class="choice-label">CLIENTES</div>
    </div>
  </div>
</div>
 <div class="home-actions">
    <button id="btnClientesBack" class="btn">Volver</button>
  </div>
</div>
    <div id="clientsMenu"class="clients-menu hidden">
     <h2 id="tituloCliente" style="text-align:center;margin-bottom:16px;">Nuevo Cliente</h2>
      <div class="sub-tabs">
        <div class="sub-tab active" data-content="tab-datos">Datos Generales</div>
        <div class="sub-tab" data-content="tab-docs">Documentaci√≥n</div>
        <div class="sub-tab" data-content="tab-tarifas">Tarifas</div>
        <div class="sub-tab" data-content="tab-comentario">Comentarios</div>
      </div>

      <div id="tab-datos" class="sub-content active">
        <h3 class="section-title">Datos Generales</h3>
        <div class="form-group"><label>Nombre / Raz√≥n Social</label><input type="text" id="inpNombre"></div>
        <div class="form-group"><label>Estatus</label><select id="selEstatus"><option>Activo</option><option>Inactivo</option></select></div>
        <div class="form-group"><label>RFC</label><input type="text" id="inpRFC"></div>
        <div class="form-group"><label>Direcci√≥n</label><textarea id="txtDireccion" style="width:100%;height:70px;border:2px solid #ccc;border-radius:6px;"></textarea></div>
        <h3 class="section-title">Contactos</h3>
<div class="form-group">
  <label>Operaciones</label>
  <input type="text" placeholder="Email">
  <input type="email" placeholder="Nombre">
  <input type="text" placeholder="Tel.">
</div>
<div class="form-group">
  <label>Administraci√≥n</label>
  <input type="text" placeholder="Email">
  <input type="email" placeholder="Nombre">
  <input type="text" placeholder="Tel.">
</div>
<div class="form-group">
  <label>Comercial</label>
  <input type="text" placeholder="Email">
  <input type="email" placeholder="Nombre">
  <input type="text" placeholder="Tel.">
</div>
 </div>       

      <div id="tab-docs" class="sub-content">
        <h3 class="section-title">Documentaci√≥n</h3>
        <div class="doc-table-wrapper">
          <table class="doc-table">
            <thead>
              <tr><th>Comprobante</th><th>Estatus</th><th>Documento</th></tr>
            </thead>
            <tbody>
              <tr>
                <td><span class="icon-btn folder" data-row="1">üìÅ</span><span class="icon-btn view" data-row="1">üîç</span><input type="file" id="file1"/></td>
                <td id="status1" class="status-no">‚ùå No</td><td>Acta Constitutiva</td>
              </tr>
              <tr>
                <td><span class="icon-btn folder" data-row="2">üìÅ</span><span class="icon-btn view" data-row="2">üîç</span><input type="file" id="file2"/></td>
                <td id="status2" class="status-no">‚ùå No</td><td>Poder Rep. Legal</td>
              </tr>
              <tr>
                <td><span class="icon-btn folder" data-row="3">üìÅ</span><span class="icon-btn view" data-row="3">üîç</span><input type="file" id="file3"/></td>
                <td id="status3" class="status-no">‚ùå No</td><td>Comprobante de Domicilio</td>
              </tr>
              <tr>
                <td><span class="icon-btn folder" data-row="4">üìÅ</span><span class="icon-btn view" data-row="4">üîç</span><input type="file" id="file4"/></td>
                <td id="status4" class="status-no">‚ùå No</td><td>Constancia de Situaci√≥n Fiscal</td>
              </tr>
              <tr>
                <td><span class="icon-btn folder" data-row="5">üìÅ</span><span class="icon-btn view" data-row="5">üîç</span><input type="file" id="file5"/></td>
                <td id="status5" class="status-no">‚ùå No</td><td>INE Rep. Legal</td>
              </tr>
              <tr>
                <td><span class="icon-btn folder" data-row="6">üìÅ</span><span class="icon-btn view" data-row="6">üîç</span><input type="file" id="file6"/></td>
                <td id="status6" class="status-no">‚ùå No</td><td>Contrato</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div id="tab-tarifas" class="sub-content"><h3 class="section-title">Tarifas</h3>
        <button class="btn add-route">+ Agregar Ruta/Tarifa</button>
        <div class="doc-table-wrapper" style="max-height:250px; overflow-y:auto;">
          <table class="doc-table" id="tablaTarifas">
            <thead>
              <tr>
                <th>Origen - Destino</th>
                <th>Tipo de Unidad</th>
                <th>Tarifa</th>
                <th>D√≠as de Cr√©dito</th>
                <th>Km a recorrer</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <!-- Filas generadas din√°micamente -->
            </tbody>
          </table>
        </div>

        <!-- Modal -->
        <div id="tarifaModal" class="modal hidden">
          <div class="modal-content">
            <span class="close" title="Cerrar">&times;</span>
            <h3>Agregar Nueva Ruta/Tarifa</h3>

            <div class="form-row">
              <div class="form-group">
                <label for="estadoOrigen">Estado de Origen*</label>
                <select id="estadoOrigen" name="estadoOrigen" required>
                  <option value="">Seleccione un estado...</option>
                  <option value="Aguascalientes">Aguascalientes</option>
                  <option value="Baja California">Baja California</option>
                  <option value="Baja California Sur">Baja California Sur</option>
                  <option value="Campeche">Campeche</option>
                  <option value="Coahuila">Coahuila</option>
                  <option value="Colima">Colima</option>
                  <option value="Chiapas">Chiapas</option>
                  <option value="Chihuahua">Chihuahua</option>
                  <option value="Ciudad de M√©xico">Ciudad de M√©xico</option>
                  <option value="Durango">Durango</option>
                  <option value="Guanajuato">Guanajuato</option>
                  <option value="Guerrero">Guerrero</option>
                  <option value="Hidalgo">Hidalgo</option>
                  <option value="Jalisco">Jalisco</option>
                  <option value="Estado de M√©xico">Estado de M√©xico</option>
                  <option value="Michoac√°n">Michoac√°n</option>
                  <option value="Morelos">Morelos</option>
                  <option value="Nayarit">Nayarit</option>
                  <option value="Nuevo Le√≥n">Nuevo Le√≥n</option>
                  <option value="Oaxaca">Oaxaca</option>
                  <option value="Puebla">Puebla</option>
                  <option value="Quer√©taro">Quer√©taro</option>
                  <option value="Quintana Roo">Quintana Roo</option>
                  <option value="San Luis Potos√≠">San Luis Potos√≠</option>
                  <option value="Sinaloa">Sinaloa</option>
                  <option value="Sonora">Sonora</option>
                  <option value="Tabasco">Tabasco</option>
                  <option value="Tamaulipas">Tamaulipas</option>
                  <option value="Tlaxcala">Tlaxcala</option>
                  <option value="Veracruz">Veracruz</option>
                  <option value="Yucat√°n">Yucat√°n</option>
                  <option value="Zacatecas">Zacatecas</option>
                </select>
              </div>

              <div class="form-group">
                <label for="municipioOrigen">Municipio de Origen</label>
                <input type="text" id="municipioOrigen" placeholder="Opcional">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="estadoDestino">Estado de Destino*</label>
                <select id="estadoDestino" name="estadoDestino" required>
                  <option value="">Seleccione un estado...</option>
                  <option value="Aguascalientes">Aguascalientes</option>
                  <option value="Baja California">Baja California</option>
                  <option value="Baja California Sur">Baja California Sur</option>
                  <option value="Campeche">Campeche</option>
                  <option value="Coahuila">Coahuila</option>
                  <option value="Colima">Colima</option>
                  <option value="Chiapas">Chiapas</option>
                  <option value="Chihuahua">Chihuahua</option>
                  <option value="Ciudad de M√©xico">Ciudad de M√©xico</option>
                  <option value="Durango">Durango</option>
                  <option value="Guanajuato">Guanajuato</option>
                  <option value="Guerrero">Guerrero</option>
                  <option value="Hidalgo">Hidalgo</option>
                  <option value="Jalisco">Jalisco</option>
                  <option value="Estado de M√©xico">Estado de M√©xico</option>
                  <option value="Michoac√°n">Michoac√°n</option>
                  <option value="Morelos">Morelos</option>
                  <option value="Nayarit">Nayarit</option>
                  <option value="Nuevo Le√≥n">Nuevo Le√≥n</option>
                  <option value="Oaxaca">Oaxaca</option>
                  <option value="Puebla">Puebla</option>
                  <option value="Quer√©taro">Quer√©taro</option>
                  <option value="Quintana Roo">Quintana Roo</option>
                  <option value="San Luis Potos√≠">San Luis Potos√≠</option>
                  <option value="Sinaloa">Sinaloa</option>
                  <option value="Sonora">Sonora</option>
                  <option value="Tabasco">Tabasco</option>
                  <option value="Tamaulipas">Tamaulipas</option>
                  <option value="Tlaxcala">Tlaxcala</option>
                  <option value="Veracruz">Veracruz</option>
                  <option value="Yucat√°n">Yucat√°n</option>
                  <option value="Zacatecas">Zacatecas</option>
                </select>
              </div>
              <div class="form-group">
                <label for="municipioDestino">Municipio de Destino</label>
                <input type="text" id="municipioDestino" placeholder="Opcional">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group form-group-full">
                <label for="tipoUnidad">Tipo de unidad*</label>
                <select id="tipoUnidad" required>
                  <option value="">Seleccione...</option>
                  <option value="Unidad seca de 53">Unidad seca de 53"</option>
                  <option value="Refrigerada de 53">Refrigerada de 53"</option>
                  <option value="Thorton">Thorton</option>
                  <option value="3.5">3.5</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="diasCredito">D√≠as de Cr√©dito</label>
                <input type="number" id="diasCredito" min="0" placeholder="0">
              </div>
              <div class="form-group">
                <label for="kmRecorrer">Km a recorrer</label>
                <input type="number" id="kmRecorrer" min="0" placeholder="0">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="tarifa">Tarifa*</label>
                <input type="number" id="tarifa" min="0" step="0.01" required placeholder="0.00">
              </div>
            </div>

            <div class="modal-buttons">
              <button type="button" class="btn-cancelar">Cancelar</button>
              <button type="button" class="btn-guardar">Guardar</button>
            </div>
          </div>
        </div>
        <!-- /Modal -->
      </div>

      <div id="tab-comentario" class="sub-content">
        <h3 class="section-title">Comentarios</h3>
            <div class="form-group"><label>Comentario</label><textarea id="txtComentario" style="width:100%;height:120px;border:2px solid #ccc;border-radius:6px;"></textarea></div>
      </div>

      <div class="button-row">
  <button id="saveClient">Guardar</button>
  <button id="exitClient">Salir</button>
</div>
    </div>
    <!-- NUEVA VENTANA: Lista de Clientes -->
<div id="clientsList" class="clients-menu clients-list hidden" aria-label="Lista de clientes">
  <div class="list-toolbar">
    <div><h3>Clientes registrados</h3></div>
    <div class="search">
      <label for="searchCli">Buscar:</label>
      <input id="searchCli" type="text" placeholder="Nombre, RFC‚Ä¶">
    </div>
    <div class="list-actions">
      <button id="btnNuevoDesdeLista" class="btn primary">+ Nuevo Cliente</button>
      <button id="btnVolverHome" class="btn">Volver</button>
      <button id="btnImportExcel" class="btn">Importar Excel</button>
      <input id="excelInput" type="file" accept=".xlsx,.xls" style="display:none">
    </div>
  </div>

  <div class="doc-table-wrapper" style="max-height:300px; overflow:auto;">
    <table class="doc-table" id="tablaClientes">
      <thead>
        <tr>
          <th>ID Cliente</th>
          <th>Nombre/Raz√≥n Social</th>
          <th>RFC</th>
          <th>Estatus</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody><!-- filas din√°micas --></tbody>
    </table>
  </div>
</div>

  </div>
<!-- Inicio Mod 2 -->
<div id="permModule" class="frame hidden" aria-label="M√≥dulo Permisionarios">

  <!-- Ventana: Permisionarios registrados -->

<div id="permsList" class="clients-menu perms-list" aria-label="Permisionarios registrados">
  <div class="list-toolbar">
    <div><h3>Permisionarios registrados</h3></div>
    <div class="search">
      <label for="searchPerm">Buscar:</label>
      <input id="searchPerm" type="text" placeholder="Nombre, RFC‚Ä¶">
    </div>
    <div class="list-actions">
   <button id="btnPermNuevo" class="btn primary">+ Nuevo Permisionario</button>
      <button id="btnPermVolver" class="btn">Volver</button>
    </div>
  </div>

  <div class="doc-table-wrapper" style="max-height:300px; overflow:auto;">
    <table class="doc-table" id="tablaPerms">
      <thead>
        <tr>
          <th>ID Permisionario</th>
          <th>Nombre/Raz√≥n Social</th>
          <th>RFC</th>
          <th>Estatus</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody><!-- filas din√°micas --></tbody>
    </table>
  </div>
</div>
  <!-- Men√∫/Formulario: Nuevo Permisionario -->
<div id="permsMenu" class="frame hidden" aria-label="Nuevo Permisionario">
  <h3>Nuevo Permisionario</h3>

  <div class="subtabs" role="tablist" aria-label="Subpesta√±as Permisionarios">
    <div class="subtab active" data-target="perm-datos" role="tab" aria-selected="true">Datos</div>
    <div class="subtab" data-target="perm-docs" role="tab">Documentos</div>
    <div class="subtab" data-target="perm-unidades" role="tab">Unidades</div>
    <div class="subtab" data-target="perm-coment" role="tab">Operadores</div>
  </div>

  <!-- Subcontenido: Datos -->
  <div id="perm-datos" class="subcontent active">
    <div class="form-row">
      <div class="fld">
        <label for="permNombre">Nombre/Raz√≥n social</label>
        <input id="permNombre" type="text" placeholder="Permisionario S.A. de C.V.">
      </div>
      <div class="fld">
        <label for="permRFC">RFC</label>
        <input id="permRFC" type="text" placeholder="XXXX010101XXX">
      </div>
    </div>
    <div class="form-row">
      <div class="fld">
        <label for="permEstatus">Estatus</label>
        <select id="permEstatus">
          <option value="Activo">Activo</option>
          <option value="Inactivo">Inactivo</option>
        </select>
      </div>
      <div class="fld">
        <label for="permContacto">Contacto</label>
        <input id="permContacto" type="text" placeholder="Nombre de contacto">
      </div>
    </div>
  </div>

  <!-- Subcontenido: Documentos -->
  <div id="perm-docs" class="subcontent">
    <div class="form-row">
      <div class="fld">
        <label for="permLicencia">Licencia/Concesi√≥n</label>
        <input id="permLicencia" type="text" placeholder="N√∫m. de concesi√≥n">
      </div>
      <div class="fld">
        <label for="permVigencia">Vigencia</label>
        <input id="permVigencia" type="date">
      </div>
    </div>
  </div>

  <!-- Subcontenido: Unidades -->
  <div id="perm-unidades" class="subcontent">
    <div class="form-row">
      <div class="fld">
        <label for="permUnidades">Unidades registradas (texto breve)</label>
        <textarea id="permUnidades" rows="3" placeholder="Ej: Tracto 1, Caja 123; Tracto 2, Caja 456‚Ä¶"></textarea>
      </div>
    </div>
  </div>

  <!-- Subcontenido: Comentarios -->
  <div id="perm-coment" class="subcontent">
    <div class="form-row">
      <div class="fld">
        <label for="permNotas">Notas / Comentarios</label>
        <textarea id="permNotas" rows="3" placeholder="Observaciones generales‚Ä¶"></textarea>
      </div>
    </div>
  </div>

  <div class="actions-bar">
    <button id="btnPermCancelar" class="btn">Cancelar</button>
    <button id="btnPermGuardar" class="btn-primary">Guardar Permisionario</button>
  </div>
</div>
</div>
  <script>
    const usuarios = [{usuario:"David Vargas R.",password:"1234"}];
    function showSection(id) {
      document.querySelectorAll('.frame').forEach(f => f.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
    }

    window.addEventListener('DOMContentLoaded', () => {
     
      /* Login */
      // --- NAVEGACI√ìN (Dashboard ‚Üí M√≥dulo Clientes)
document.getElementById('modClientes').onclick = () => {
  showSection('clientsModule');
  // Al entrar al m√≥dulo, mostramos la pantalla de inicio (dos tarjetas)
  document.getElementById('clientsHome')?.classList.remove('hidden');
  document.getElementById('clientsMenu')?.classList.add('hidden');
  document.getElementById('clientsList')?.classList.add('hidden');
};
  // === Navegaci√≥n: Dashboard ‚Üí M√≥dulo Permisionarios ===
document.getElementById('modPerm').onclick = () => {
  showSection('permModule');              // muestra el frame de Permisionarios
  renderTablaPerms();                     // pinta/actualiza la tabla
};

// === ‚ÄúBD‚Äù local simple de permisionarios ===
const srPermKey = 'sr_permisionarios';
function getPerms(){ try { return JSON.parse(localStorage.getItem(srPermKey)) || []; } catch { return []; } }
function setPerms(arr){ localStorage.setItem(srPermKey, JSON.stringify(arr)); }

// === Render de la tabla de Permisionarios ===
function renderTablaPerms(filtro=''){
  const tbody = document.querySelector('#tablaPerms tbody');
  if(!tbody) return;

  const data = getPerms();
  const q = (filtro||'').toLowerCase();

  const fil = data.filter(p =>
    (!q) ||
    (String(p.id||'').toLowerCase().includes(q) ||
     (p.nombre||'').toLowerCase().includes(q) ||
     (p.rfc||'').toLowerCase().includes(q))
  );

  tbody.innerHTML = fil.map(p => `
    <tr>
      <td>${p.id || ''}</td>
      <td>${p.nombre || ''}</td>
      <td>${p.rfc || ''}</td>
      <td>${p.estatus || 'Activo'}</td>
      <td class="actions">
        <span class="icon-btn btnPermEdit" title="Editar" data-id="${p.id}">‚úèÔ∏è</span>
        <span class="icon-btn btnPermDelete btnDelete" title="Eliminar" data-id="${p.id}">üóëÔ∏è</span>
      </td>
    </tr>
  `).join('') || `<tr><td colspan="5">Sin registros</td></tr>`;

  // Listeners por fila
  tbody.querySelectorAll('.btnPermDelete').forEach(btn => {
    btn.addEventListener('click', () => openDeletePerm(btn.dataset.id));
  });
  tbody.querySelectorAll('.btnPermEdit').forEach(btn => {
    btn.addEventListener('click', () => editPerm(btn.dataset.id));
  });
}

// === Buscar en la lista de Permisionarios ===
document.getElementById('searchPerm')?.addEventListener('input', (e) => {
  renderTablaPerms(e.target.value);
});

// === Volver al Dashboard desde Permisionarios ===
document.getElementById('btnPermVolver')?.addEventListener('click', () => {
  showSection('dashboard');
});

// === Eliminar Permisionario (reusa tu modal de confirmaci√≥n) ===
let deletePermId = null;
function openDeletePerm(id){
  deletePermId = id;
  // Reutilizamos el mismo modal de confirmaci√≥n existente
  const confirmDeleteModal = document.getElementById('confirmDeleteModal');
  confirmDeleteModal.classList.remove('hidden');
  confirmDeleteModal.style.display = 'flex';

  // Aseguramos handlers locales:
  const yes = document.getElementById('deleteConfirmYes');
  const no  = document.getElementById('deleteConfirmNo');

  const onYes = () => {
    const arr = getPerms();
    const idx = arr.findIndex(p => p.id === deletePermId);
    if(idx >= 0){ arr.splice(idx,1); setPerms(arr); renderTablaPerms(); }
    cleanup();
  };
  const onNo = cleanup;

  function cleanup(){
    // Cerramos modal
    confirmDeleteModal.classList.add('hidden');
    confirmDeleteModal.style.display = 'none';
    // Quitamos estos listeners puntuales para no duplicar
    yes.removeEventListener('click', onYes);
    no.removeEventListener('click', onNo);
    deletePermId = null;
  }

  yes.addEventListener('click', onYes);
  no.addEventListener('click', onNo);
}

// === Editar Permisionario (flujo m√≠nimo: por ahora solo alerta) ===
function editPerm(id){
  const perm = getPerms().find(p => p.id === id);
  if(!perm){ return; }
  // Aqu√≠ puedes abrir un formulario de edici√≥n (similar a "Nuevo Cliente")
  alert(`Editar Permisionario: ${perm.id} - ${perm.nombre}`);
}

// === Utilidad para generar ID consecutivo tipo LTR-PR-01 ===
function generarSiguienteIdPerm(arr){
  const prefijo = 'LTR-PR-';
  const maxNum = arr.reduce((max, p) => {
    const m = (p.id || '').match(/^LTR-PR-(\d+)$/);
    const n = m ? parseInt(m[1], 10) : 0;
    return n > max ? n : max;
  }, 0);
  return `${prefijo}${String(maxNum + 1).padStart(2, '0')}`;
}

// (Opcional) Semilla de ejemplo para que veas algo en la tabla la 1¬™ vez:
if(getPerms().length === 0){
  setPerms([
    { id: 'LTR-PR-01', nombre: 'Permisionario Demo S.A. de C.V.', rfc: 'PDE010101AB1', estatus: 'Activo' },
    { id: 'LTR-PR-02', nombre: 'Transporte Ejemplar S.A.', rfc: 'TEJ020202CD2', estatus: 'Inactivo' }
  ]);
  }
  
  // === Mostrar formulario Nuevo Permisionario ===
document.getElementById('btnPermNuevo')?.addEventListener('click', () => {
  // Limpiar formulario
  document.getElementById('permNombre').value = '';
  document.getElementById('permRFC').value = '';
  document.getElementById('permEstatus').value = 'Activo';
  document.getElementById('permContacto').value = '';
  document.getElementById('permLicencia').value = '';
  document.getElementById('permVigencia').value = '';
  document.getElementById('permUnidades').value = '';
  document.getElementById('permNotas').value = '';

  // Reset de subpesta√±as
  document.querySelectorAll('#permsMenu .subtab').forEach(t => t.classList.remove('active'));
  document.querySelector('#permsMenu .subtab[data-target="perm-datos"]').classList.add('active');
  document.querySelectorAll('#permsMenu .subcontent').forEach(c => c.classList.remove('active'));
  document.getElementById('perm-datos').classList.add('active');

  // Mostrar formulario y ocultar lista
  document.getElementById('permsList').classList.add('hidden');
  document.getElementById('permsMenu').classList.remove('hidden');
});

// === Subpesta√±as (Datos / Documentos / Unidades / Comentarios) ===
document.querySelectorAll('#permsMenu .subtab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('#permsMenu .subtab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    const tgt = tab.dataset.target;
    document.querySelectorAll('#permsMenu .subcontent').forEach(c => c.classList.remove('active'));
    document.getElementById(tgt).classList.add('active');
  });
});

// === Cancelar (volver a la lista) ===
document.getElementById('btnPermCancelar')?.addEventListener('click', () => {
  document.getElementById('permsMenu').classList.add('hidden');
  document.getElementById('permsList').classList.remove('hidden');
});

// === Guardar Permisionario ===
document.getElementById('btnPermGuardar')?.addEventListener('click', () => {
  const nombre   = document.getElementById('permNombre').value.trim();
  const rfc      = document.getElementById('permRFC').value.trim();
  const estatus  = document.getElementById('permEstatus').value;
  const contacto = document.getElementById('permContacto').value.trim();
  const licencia = document.getElementById('permLicencia').value.trim();
  const vigencia = document.getElementById('permVigencia').value;
  const unidades = document.getElementById('permUnidades').value.trim();
  const notas    = document.getElementById('permNotas').value.trim();

  if(!nombre || !rfc){
    alert('Por favor, completa al menos Nombre/Raz√≥n social y RFC.');
    return;
  }

  const arr = getPerms();
  const id = generarSiguienteIdPerm(arr);

  arr.push({
    id, nombre, rfc, estatus,
    contacto, licencia, vigencia, unidades, notas
  });
  setPerms(arr);

  // Feedback (puedes reemplazar por tu modal de √©xito)
  alert(`¬°Permisionario guardado!\nID: ${id}\nNombre: ${nombre}`);

  // Volver a la lista y refrescar
  document.getElementById('permsMenu').classList.add('hidden');
  document.getElementById('permsList').classList.remove('hidden');
  renderTablaPerms();
});
    

// --- Helpers de vistas dentro del m√≥dulo de clientes (HOISTED/FUERA de cualquier click)
const clientsHome = document.getElementById('clientsHome');
const clientsMenu = document.getElementById('clientsMenu');
const clientsList = document.getElementById('clientsList');

function showInClientsModule(el){
  [clientsHome, clientsMenu, clientsList].forEach(x => x && x.classList.add('hidden'));
  el && el.classList.remove('hidden');
}

// ‚ÄúBD‚Äù local simple de clientes (HOISTED)
const srStoreKey = 'sr_clientes';
let editingClientId = null;
function getClientes(){ try { return JSON.parse(localStorage.getItem(srStoreKey)) || []; } catch { return []; } }
function setClientes(arr){ localStorage.setItem(srStoreKey, JSON.stringify(arr)); }

function renderTablaClientes(filtro=''){
  const tbody = document.querySelector('#tablaClientes tbody');
  if(!tbody) return;
  const data = getClientes();
  const q = (filtro||'').toLowerCase();
  const fil = data.filter(c =>
    (!q) || (c.nombre?.toLowerCase().includes(q) || c.rfc?.toLowerCase().includes(q) || String(c.id||'').toLowerCase().includes(q))
  );

  tbody.innerHTML = fil.map(c => `
    <tr>
      <td><span class="client-id-link" data-id="${c.id}">${c.id || ''}</span></td>
      <td>${c.nombre || ''}</td>
      <td>${c.rfc || ''}</td>
      <td>${c.estatus || 'Activo'}</td>
      <td class="actions">
              <span class="icon-btn btnEdit" title="Editar" data-id="${c.id}">‚úèÔ∏è</span>
        <span class="icon-btn btnDelete" title="Eliminar" data-id="${c.id}">üóëÔ∏è</span>
      </td>
    </tr>
  `).join('') || `<tr><td colspan="5">Sin registros</td></tr>`;

  // Listeners (si prefieres mantenerlos as√≠)
  tbody.querySelectorAll('.btnDelete').forEach(btn => {
    btn.addEventListener('click', () => openDeleteModal(btn.dataset.id));
  });
   tbody.querySelectorAll('.btnEdit').forEach(btn => {
    btn.addEventListener('click', () => editCliente(btn.dataset.id));
  });
  tbody.querySelectorAll('.client-id-link').forEach(link => {
    link.addEventListener('click', () => mostrarDetalleCliente(link.dataset.id));
  });
}
// --- Eliminar cliente ---
const confirmDeleteModal = document.getElementById('confirmDeleteModal');
const deleteConfirmYes = document.getElementById('deleteConfirmYes');
const deleteConfirmNo  = document.getElementById('deleteConfirmNo');
let deleteId = null;

function openDeleteModal(id){
  deleteId = id;
  confirmDeleteModal.classList.remove('hidden');
  confirmDeleteModal.style.display = 'flex';
}
function closeDeleteModal(){
  confirmDeleteModal.classList.add('hidden');
  confirmDeleteModal.style.display = 'none';
  deleteId = null;
}
deleteConfirmYes?.addEventListener('click', () => {
  if(deleteId){
    const arr = getClientes();
    const idx = arr.findIndex(c => c.id === deleteId);
    if(idx >= 0){
      arr.splice(idx,1);
      setClientes(arr);
      renderTablaClientes();
    }
  }
  closeDeleteModal();
});
deleteConfirmNo?.addEventListener('click', closeDeleteModal);
confirmDeleteModal?.querySelector('.close')?.addEventListener('click', closeDeleteModal);
window.addEventListener('click', e => { if(e.target === confirmDeleteModal) closeDeleteModal(); });

// --- Editar cliente ---
function editCliente(id){
  const cliente = getClientes().find(c => c.id === id);
  if(!cliente) return;
  editingClientId = id;
  document.getElementById('tituloCliente').textContent = 'Editar Cliente';
  showInClientsModule(clientsMenu);
  document.querySelector('.sub-tab[data-content="tab-datos"]')?.click();
  limpiarFormularioCliente();
  document.getElementById('inpNombre').value = cliente.nombre || '';
  document.getElementById('selEstatus').value = cliente.estatus || 'Activo';
  document.getElementById('inpRFC').value = cliente.rfc || '';
  document.getElementById('txtDireccion').value = cliente.domicilio || '';
  document.getElementById('txtComentario').value = cliente.comentario || '';
  (cliente.docs || []).forEach((doc, idx) => {
    const st = document.getElementById(`status${idx+1}`);
    if(st){
      if(doc.estatus){
        st.textContent = '‚úÖ S√≠';
        st.classList.remove('status-no');
        st.classList.add('status-yes');
      } else {
        st.textContent = '‚ùå No';
        st.classList.remove('status-yes');
        st.classList.add('status-no');
      }
    }
  });
  const tarifasBody = document.querySelector('#tablaTarifas tbody');
  if(tarifasBody){
    tarifasBody.innerHTML = '';
    (cliente.tarifas || []).forEach(t => {
      const tr = document.createElement('tr');
      tr.dataset.info = JSON.stringify(t);
      const cOrigenDestino = `${t.estadoOrigen} - ${t.estadoDestino}`;
      const cTipo = t.tipoUnidad;
      const cTarifa = Number(t.tarifa).toLocaleString('es-MX', {style:'currency', currency:'MXN'});
      const cCred  = t.diasCredito || 0;
      const cKm    = t.kmRecorrer || 0;
      tr.innerHTML = `<td>${cOrigenDestino}</td><td>${cTipo}</td><td>${cTarifa}</td><td>${cCred}</td><td>${cKm}</td><td><span class="icon-btn edit-tarifa" title="Editar">‚úèÔ∏è</span></td>`;
      tarifasBody.appendChild(tr);
    });
  }
}

      
// Limpiar formularios del apartado "Nuevo Cliente"
function limpiarFormularioCliente(){
  if(!clientsMenu) return;
  clientsMenu.querySelectorAll('input, textarea').forEach(el => {
    el.value = '';
    if(el.type === 'file'){ el.value = ''; }
  });
  clientsMenu.querySelectorAll('select').forEach(sel => sel.selectedIndex = 0);
  // Reinicia los estados de documentaci√≥n
  clientsMenu.querySelectorAll('.status').forEach(st => {
    st.textContent = '‚ùå No';
    st.classList.remove('status-yes');
    st.classList.add('status-no');
  });
  // Limpia la tabla de tarifas
  const tarifasBody = document.querySelector('#tablaTarifas tbody');
  if(tarifasBody) tarifasBody.innerHTML = '';
}

// --- Bot√≥n ‚ÄúNuevo Cliente‚Äù (tarjeta izquierda)
document.getElementById('btnNuevoCliente')?.addEventListener('click', () => {
  editingClientId = null;
  limpiarFormularioCliente();
  document.getElementById('tituloCliente').textContent = 'Nuevo Cliente';
  showInClientsModule(clientsMenu);
  // Activa la subpesta√±a ‚ÄúDatos‚Äù
  document.querySelector('.sub-tab[data-content="tab-datos"]')?.click();
});

// --- Bot√≥n ‚ÄúCLIENTES‚Äù (tarjeta derecha)
document.getElementById('btnVerClientes')?.addEventListener('click', () => {
   editingClientId = null;
  document.getElementById('tituloCliente').textContent = 'Nuevo Cliente';
  showInClientsModule(clientsList);
  renderTablaClientes(); // pinta/actualiza la tabla
  limpiarFormularioCliente(); // limpia formulario de nuevo cliente
});

      
// --- Volver al dashboard desde el men√∫ principal de Clientes ---
document.getElementById('btnClientesBack')?.addEventListener('click', () => {
  showSection('dashboard');
});

         
// --- Botones dentro de la ventana ‚ÄúClientes‚Äù
document.getElementById('btnVolverHome')?.addEventListener('click', () => {
  editingClientId = null;
  document.getElementById('tituloCliente').textContent = 'Nuevo Cliente';
  showInClientsModule(clientsHome);
});

document.getElementById('btnNuevoDesdeLista')?.addEventListener('click', () => {
  editingClientId = null;
  limpiarFormularioCliente();
  document.getElementById('tituloCliente').textContent = 'Nuevo Cliente';
  showInClientsModule(clientsMenu);
  document.querySelector('.sub-tab[data-content="tab-datos"]')?.click();
});

// --- B√∫squeda en la lista
document.getElementById('searchCli')?.addEventListener('input', (e) => {
  renderTablaClientes(e.target.value);
});

      const last = localStorage.getItem('sr_last_user');
      if (last) document.getElementById('usuario').value = last;
      document.getElementById('btnGuardar').onclick = () => {
        localStorage.setItem('sr_last_user', document.getElementById('usuario').value);
        alert('Usuario guardado');
      };
      document.getElementById('btnEntrar').onclick = () => {
        const u = document.getElementById('usuario').value;
        const p = document.getElementById('password').value;
        if (usuarios.find(x => x.usuario === u && x.password === p)) showSection('dashboard');
        else alert('Usuario o contrase√±a incorrectos');
      };

      document.querySelectorAll('.sub-tab').forEach(tab => {
        tab.onclick = () => {
          document.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.sub-content').forEach(c => c.classList.remove('active'));
          tab.classList.add('active');
          document.getElementById(tab.dataset.content).classList.add('active');
        };
      });
      document.getElementById('exitClient').onclick = () => showSection('dashboard');
// Mostrar/ocultar bot√≥n Guardar seg√∫n la pesta√±a activa
const saveBtn = document.getElementById('saveClient');
function updateSaveButtonVisibility() {
  const activeTab = document.querySelector('.sub-tab.active');
  if (activeTab && activeTab.dataset.content === 'tab-comentario') {
    saveBtn.style.display = 'inline-block';
  } else {
    saveBtn.style.display = 'none';
  }
}
updateSaveButtonVisibility();

document.querySelectorAll('.sub-tab').forEach(tab => {
  tab.addEventListener('click', updateSaveButtonVisibility);
});

// --- Guardar cliente y mostrar confirmaci√≥n ---
const clienteModal = document.getElementById('clienteModal');
const clienteModalClose = clienteModal.querySelector('.close');
const clienteModalBtnCerrar = clienteModal.querySelector('.btn-cerrar');

// Funci√≥n para generar siguiente ID consecutivo
function generarSiguienteId(arr) {
  const prefijo = 'LTR-CL-';
  const maxNum = arr.reduce((max, c) => {
    const m = (c.id || '').match(/^LTR-CL-(\d+)$/);
    const n = m ? parseInt(m[1], 10) : 0;
    return n > max ? n : max;
  }, 0);
  return `${prefijo}${String(maxNum + 1).padStart(2, '0')}`;
}

saveBtn.addEventListener('click', () => {
  const nombre = (document.getElementById('inpNombre')?.value || '').trim();
  const rfc = (document.getElementById('inpRFC')?.value || '').trim();
  const estatus = document.getElementById('selEstatus')?.value || 'Activo';
  const domicilio = (document.getElementById('txtDireccion')?.value || '').trim();
const comentario = (document.getElementById('txtComentario')?.value || '').trim();

  const docNames = [
    'Acta Constitutiva',
    'Poder Rep. Legal',
    'Comprobante de Domicilio',
    'Constancia de Situaci√≥n Fiscal',
    'INE Rep. Legal',
    'Contrato'
  ];
  const docs = docNames.map((nombre, idx) => {
    const st = document.getElementById(`status${idx+1}`);
    return { nombre, estatus: st?.classList.contains('status-yes') };
  });

  const tarifas = Array.from(document.querySelectorAll('#tablaTarifas tbody tr')).map(tr => {
    try { return JSON.parse(tr.dataset.info || '{}'); } catch { return {}; }
  });
  // Validaci√≥n b√°sica
  if (!nombre || !rfc) {
    alert('Por favor llena al menos Nombre/Raz√≥n Social y RFC.');
    return;
  }

  const arr = getClientes();
  let id = editingClientId;
  if(editingClientId){
    const idx = arr.findIndex(c => c.id === editingClientId);
    if(idx >= 0){
      arr[idx] = { id: editingClientId, nombre, rfc, estatus, domicilio, comentario, docs, tarifas };
    }
  } else {
    id = generarSiguienteId(arr);
    arr.push({ id, nombre, rfc, estatus, domicilio, comentario, docs, tarifas });
  }
  setClientes(arr);

  // üîÑ Actualizar tabla en vista "Clientes registrados"
  renderTablaClientes();

  // Llenar modal de confirmaci√≥n
  document.getElementById('idClienteTexto').textContent = id;
  document.getElementById('nombreCliente').textContent = nombre;
  document.getElementById('rfcCliente').textContent = rfc;
  document.getElementById('domicilioCliente').textContent = domicilio;

  // Mostrar modal
  clienteModal.classList.remove('hidden');
  clienteModal.style.display = 'flex';
  editingClientId = null;

 document.getElementById('tituloCliente').textContent = 'Nuevo Cliente';
});

// Cerrar modal de confirmaci√≥n
function cerrarClienteModal() {
  clienteModal.classList.add('hidden');
  clienteModal.style.display = 'none';
}
clienteModalClose.addEventListener('click', cerrarClienteModal);
clienteModalBtnCerrar.addEventListener('click', cerrarClienteModal);
window.addEventListener('click', (e) => {
  if (e.target === clienteModal) cerrarClienteModal();
});

clienteModalClose.addEventListener('click', () => {
  clienteModal.classList.add('hidden');
  clienteModal.style.display = 'none';
});

window.addEventListener('click', (e) => {
  if (e.target === clienteModal) {
    clienteModal.classList.add('hidden');
    clienteModal.style.display = 'none';
  }
});

      /* Documentaci√≥n */
      document.querySelectorAll('.folder').forEach(btn => {
        btn.onclick = () => {
          const row = btn.dataset.row;
          const inp = document.getElementById('file' + row);
          inp.click();
          inp.onchange = () => {
            const st = document.getElementById('status' + row);
            st.textContent = '‚úÖ S√≠';
            st.classList.remove('status-no');
            st.classList.add('status-yes');
          };
        };
      });
      document.querySelectorAll('.view').forEach(btn => {
        btn.onclick = () => {
          const row = btn.dataset.row;
          const inp = document.getElementById('file' + row);
          if (inp.files.length) {
            const url = URL.createObjectURL(inp.files[0]);
            window.open(url);
          } else {
            alert('No hay archivo cargado a√∫n');
          }
        };
      });

      /* --- Tarifas / Modal --- */
      const modal = document.getElementById('tarifaModal');
      const tablaTarifas = document.querySelector('#tablaTarifas tbody');
      // fila en edici√≥n (si es null, se crear√° una nueva)
      let editingRow = null;
      const tituloModal = modal.querySelector('h3');

      function mostrarModal() {
        modal.classList.remove('hidden');
        modal.style.display = 'flex';
      }
      function ocultarModal() {
        modal.classList.add('hidden');
        modal.style.display = 'none';
      }
      function activarTabTarifas() {
        document.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.sub-content').forEach(c => c.classList.remove('active'));
        document.querySelector('.sub-tab[data-content="tab-tarifas"]').classList.add('active');
        document.getElementById('tab-tarifas').classList.add('active');
      }
      function limpiarFormulario() {
        document.getElementById('estadoOrigen').value = '';
        document.getElementById('municipioOrigen').value = '';
        document.getElementById('estadoDestino').value = '';
        document.getElementById('municipioDestino').value = '';
        document.getElementById('tipoUnidad').selectedIndex = 0;
        document.getElementById('diasCredito').value = '';
        document.getElementById('kmRecorrer').value = '';
        document.getElementById('tarifa').value = '';
      }
      function cargarFormulario(datos) {
        document.getElementById('estadoOrigen').value   = datos.estadoOrigen || '';
        document.getElementById('municipioOrigen').value= datos.municipioOrigen || '';
        document.getElementById('estadoDestino').value  = datos.estadoDestino || '';
        document.getElementById('municipioDestino').value= datos.municipioDestino || '';
        document.getElementById('tipoUnidad').value     = datos.tipoUnidad || '';
        document.getElementById('diasCredito').value    = datos.diasCredito ?? '';
        document.getElementById('kmRecorrer').value     = datos.kmRecorrer ?? '';
        document.getElementById('tarifa').value         = datos.tarifa ?? '';
      }
      function guardarTarifa() {
        const datos = {
          estadoOrigen: document.getElementById('estadoOrigen').value.trim(),
          municipioOrigen: document.getElementById('municipioOrigen').value.trim(),
          estadoDestino: document.getElementById('estadoDestino').value.trim(),
          municipioDestino: document.getElementById('municipioDestino').value.trim(),
          tipoUnidad: document.getElementById('tipoUnidad').value,
          diasCredito: document.getElementById('diasCredito').value,
          kmRecorrer: document.getElementById('kmRecorrer').value,
          tarifa: document.getElementById('tarifa').value
        };

        if (!datos.estadoOrigen || !datos.estadoDestino || !datos.tipoUnidad || !datos.tarifa) {
          alert('Por favor complete todos los campos obligatorios (*)');
          return;
        }

        const cOrigenDestino = `${datos.estadoOrigen} - ${datos.estadoDestino}`;
        const cTipo = datos.tipoUnidad;
        const cTarifa = Number(datos.tarifa).toLocaleString('es-MX', {style:'currency', currency:'MXN'});
        const cCred  = datos.diasCredito || 0;
        const cKm    = datos.kmRecorrer || 0;

        if (editingRow) {
          // Actualiza celdas existentes
          editingRow.cells[0].textContent = cOrigenDestino;
          editingRow.cells[1].textContent = cTipo;
          editingRow.cells[2].textContent = cTarifa;
          editingRow.cells[3].textContent = cCred;
          editingRow.cells[4].textContent = cKm;
          editingRow.dataset.info = JSON.stringify(datos);
        } else {
          const tr = document.createElement('tr');
          tr.dataset.info = JSON.stringify(datos);
          tr.innerHTML = `
            <td>${cOrigenDestino}</td>
            <td>${cTipo}</td>
            <td>${cTarifa}</td>
            <td>${cCred}</td>
            <td>${cKm}</td>
            <td><span class="icon-btn edit-tarifa" title="Editar">‚úèÔ∏è</span></td>
          `;
          tablaTarifas.appendChild(tr);
        }

        ocultarModal();
        limpiarFormulario();
        activarTabTarifas();
        // Reiniciar estado de edici√≥n
        editingRow = null;
        tituloModal.textContent = 'Agregar Nueva Ruta/Tarifa';
      }

      const agregarBtn = document.querySelector('.add-route');
      if (agregarBtn) agregarBtn.addEventListener('click', mostrarModal);
      if (agregarBtn) agregarBtn.addEventListener('click', () => {
        editingRow = null;
        tituloModal.textContent = 'Agregar Nueva Ruta/Tarifa';
        limpiarFormulario();
      });

      document.querySelector('#tarifaModal .close').addEventListener('click', () => { ocultarModal(); activarTabTarifas(); });
      document.querySelector('#tarifaModal .btn-cancelar').addEventListener('click', () => { ocultarModal(); activarTabTarifas(); });
      document.querySelector('#tarifaModal .btn-guardar').addEventListener('click', guardarTarifa);

      window.addEventListener('click', (e) => { if (e.target === modal) ocultarModal(); });

          // Delegaci√≥n: clic en √≠cono ‚úèÔ∏è para editar
        tablaTarifas.addEventListener('click', (e) => {
          const btn = e.target.closest('.edit-tarifa');
          if (!btn) return;
          const row = btn.closest('tr');
          try {
            const datos = JSON.parse(row.dataset.info || '{}');
            cargarFormulario(datos);
            editingRow = row;
            tituloModal.textContent = 'Editar Ruta/Tarifa';
            mostrarModal();
          } catch {
            alert('No fue posible cargar los datos de la fila para edici√≥n.');
          }
        });
      function mostrarModalConfirmacion(cliente) {
  document.getElementById('idClienteTexto').textContent = cliente.id;
  document.getElementById('nombreCliente').textContent = cliente.nombre;
  document.getElementById('rfcCliente').textContent = cliente.rfc;
  document.getElementById('domicilioCliente').textContent = cliente.domicilio;

  document.getElementById('clienteModal').classList.remove('hidden');
  document.getElementById('clienteModal').style.display = 'flex';
}

document.querySelector('#clienteModal .btn-cerrar').addEventListener('click', () => {
  document.getElementById('clienteModal').classList.add('hidden');
  document.getElementById('clienteModal').style.display = 'none';
});

      
function mostrarDetalleCliente(id){
  const cliente = getClientes().find(c => c.id === id);
  if(!cliente) return;
  const cont = document.getElementById('detalleClienteContenido');
  const docList = (cliente.docs || []).map(d => `<li>${d.nombre}: ${d.estatus ? 'S√≠' : 'No'}</li>`).join('');
  const tarifasTabla = (cliente.tarifas && cliente.tarifas.length)
    ? `<table class="doc-table"><thead><tr><th>Origen - Destino</th><th>Tipo de Unidad</th><th>Tarifa</th><th>D√≠as de Cr√©dito</th><th>Km</th></tr></thead><tbody>${cliente.tarifas.map(t => `<tr><td>${t.estadoOrigen} - ${t.estadoDestino}</td><td>${t.tipoUnidad}</td><td>${Number(t.tarifa).toLocaleString('es-MX',{style:'currency',currency:'MXN'})}</td><td>${t.diasCredito}</td><td>${t.kmRecorrer}</td></tr>`).join('')}</tbody></table>`
    : '<p>Sin tarifas registradas</p>';
  cont.innerHTML = `
    <h3 class="section-title">Datos Generales</h3>
    <p><strong>Nombre/Raz√≥n Social:</strong> ${cliente.nombre || ''}</p>
    <p><strong>RFC:</strong> ${cliente.rfc || ''}</p>
    <p><strong>Estatus:</strong> ${cliente.estatus || ''}</p>
    <p><strong>Domicilio:</strong> ${cliente.domicilio || ''}</p>
    <h3 class="section-title">Contactos</h3>
    <p><strong>Operaciones:</strong> ${((cliente.contactos||{}).operaciones||{}).nombre||""} / ${((cliente.contactos||{}).operaciones||{}).email||""} / ${((cliente.contactos||{}).operaciones||{}).tel||""}</p>
    <p><strong>Administraci√≥n:</strong> ${((cliente.contactos||{}).administracion||{}).nombre||""} / ${((cliente.contactos||{}).administracion||{}).email||""} / ${((cliente.contactos||{}).administracion||{}).tel||""}</p>
    <p><strong>Comercial:</strong> ${((cliente.contactos||{}).comercial||{}).nombre||""} / ${((cliente.contactos||{}).comercial||{}).email||""} / ${((cliente.contactos||{}).comercial||{}).tel||""}</p>
    <h3 class="section-title">Tarifas</h3>
    ${tarifasTabla}
    <h3 class="section-title">Documentaci√≥n</h3>
    <ul>${docList}</ul>
    <h3 class="section-title">Comentarios</h3>
    <p>${cliente.comentario || ''}</p>
  `;
  const modal = document.getElementById('detalleClienteModal');
  modal.classList.remove('hidden');
  modal.style.display = 'flex';
}

const detalleModal = document.getElementById('detalleClienteModal');
detalleModal.querySelector('.close').addEventListener('click', () => {
  detalleModal.classList.add('hidden');
  detalleModal.style.display = 'none';
});
window.addEventListener('click', (e) => {
  if (e.target === detalleModal) {
    detalleModal.classList.add('hidden');
    detalleModal.style.display = 'none';
  }
});
    });
  </script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<script>
// --- Importaci√≥n desde Excel (Clientes, Documentaci√≥n, Tarifas y Contactos) ---
document.getElementById('btnImportExcel')?.addEventListener('click', () => {
  document.getElementById('excelInput').click();
});
function _norm(s){ return (String(s||'').trim()).replace(/\s+/g,' '); }

document.getElementById('excelInput')?.addEventListener('change', async (e) => {
  const file = e.target.files[0];
  if (!file) return;
  try{
    const data = await file.arrayBuffer();
    const wb = XLSX.read(data, { type: 'array' });

    const shClientes = wb.Sheets['Clientes'];
    const shDocs     = wb.Sheets['Documentaci√≥n'];
    const shTarifas  = wb.Sheets['Tarifas'];

    const rowsClientes = shClientes ? XLSX.utils.sheet_to_json(shClientes) : [];
    const rowsDocs     = shDocs     ? XLSX.utils.sheet_to_json(shDocs) : [];
    const rowsTarifas  = shTarifas  ? XLSX.utils.sheet_to_json(shTarifas) : [];

    // Indexar docs y tarifas por RFC
    const docsByRFC = {};
    rowsDocs.forEach(r => { docsByRFC[_norm(r.RFC)] = r; });

    const tarifasByRFC = {};
    rowsTarifas.forEach(r => {
      const rfc = _norm(r.RFC);
      if(!rfc) return;
      (tarifasByRFC[rfc] ||= []).push({
        estadoOrigen: _norm(r['Estado Origen']),
        municipioOrigen: _norm(r['Municipio Origen']),
        estadoDestino: _norm(r['Estado Destino']),
        municipioDestino: _norm(r['Municipio Destino']),
        tipoUnidad: _norm(r['Tipo Unidad']),
        diasCredito: Number(r['Dias Credito']||0),
        kmRecorrer: Number(r['Km Recorrer']||0),
        tarifa: Number(r['Tarifa']||0)
      });
      
    });

    const docNames = [
      'Acta Constitutiva',
      'Poder Rep. Legal',
      'Comprobante de Domicilio',
      'Constancia de Situaci√≥n Fiscal',
      'INE Rep. Legal',
      'Contrato'
    ];

    const existentes = getClientes();
    const porRFC = {};
    existentes.forEach(c => { if (c.rfc) porRFC[_norm(c.rfc)] = c; });

    rowsClientes.forEach(r => {
      const nombre = _norm(r['Nombre'] || r['Nombre/Raz√≥n Social']);
      const rfc    = _norm(r['RFC']);
      if(!nombre || !rfc) return; // requeridos

      const estatus   = _norm(r['Estatus']||'Activo') || 'Activo';
      const domicilio = _norm(r['Domicilio'] || r['Direcci√≥n']);
      const comentario= _norm(r['Comentario']);

      // Contactos (opcionales)
      const contactos = {
        operaciones: {
          nombre: _norm(r['Contacto Operaciones (Nombre)']),
          email:  _norm(r['Contacto Operaciones (Email)']),
          tel:    _norm(r['Contacto Operaciones (Tel)']),
        },
        administracion: {
          nombre: _norm(r['Contacto Administraci√≥n (Nombre)'] || r['Contacto Administracion (Nombre)']),
          email:  _norm(r['Contacto Administraci√≥n (Email)']  || r['Contacto Administracion (Email)']),
          tel:    _norm(r['Contacto Administraci√≥n (Tel)']    || r['Contacto Administracion (Tel)']),
        },
        comercial: {
          nombre: _norm(r['Contacto Comercial (Nombre)']),
          email:  _norm(r['Contacto Comercial (Email)']),
          tel:    _norm(r['Contacto Comercial (Tel)']),
        }
      };

      const drow = docsByRFC[rfc] || {};
      const docs = docNames.map(n => ({
        nombre: n,
        estatus: String(drow[n]||'No').toLowerCase().startsWith('s')
      }));

      const tarifas = (tarifasByRFC[rfc] || []).map(t => ({ ...t }));

      const existente = porRFC[rfc];
      if (existente) {
        existente.nombre = nombre;
        existente.estatus = estatus;
        existente.domicilio = domicilio;
        existente.comentario = comentario;
        existente.docs = docs;
        existente.tarifas = tarifas;
        existente.contactos = contactos;
      } else {
        const nuevoId = generarSiguienteId(existentes);
        const nuevo = { id: nuevoId, nombre, rfc, estatus, domicilio, comentario, docs, tarifas, contactos };
        existentes.push(nuevo);
        porRFC[rfc] = nuevo;
      }
    });

    setClientes(existentes);
    renderTablaClientes();
    alert('Importaci√≥n completada ‚úÖ');
    e.target.value = '';
  }catch(err){
    console.error(err);
    alert('No fue posible leer el archivo. Verifica que sea .xlsx y tenga las hojas: Clientes, Documentacion y Tarifas.');
  }
});
</script>

</body>
</html>
